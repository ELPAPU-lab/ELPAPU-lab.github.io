<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PAPU Speedruns</title>
<style>
/* --- Estilos iguales que tu CSS anterior --- */
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
body{background:black;color:white;margin:0;font-family:'Press Start 2P', monospace;overflow-x:hidden;position:relative;}
body::before{content:"";position:fixed;top:0;left:0;width:200%;height:200%;background-image:repeating-linear-gradient(45deg,#222 0 1px,#111 1px 2px);z-index:-1;animation:bgMove 20s linear infinite;}
@keyframes bgMove{0%{transform:translate(0,0);}50%{transform:translate(-50px,50px);}100%{transform:translate(0,0);}}
.menu{position:fixed;top:20px;right:30px;font-size:48px;cursor:pointer;z-index:100;}
.menu-panel{display:none;position:fixed;top:90px;right:30px;background:#111;border:4px solid white;padding:20px;width:320px;z-index:100;}
.menu-panel button{width:100%;margin-bottom:12px;padding:14px;font-family:'Press Start 2P';font-size:14px;background:black;color:white;border:3px solid white;cursor:pointer;transition:transform 0.15s, box-shadow 0.15s;}
.menu-panel button:hover{transform:scale(1.05) rotate(-1deg);box-shadow:0 0 12px white;}
#currentCategory{text-align:center;font-size:28px;margin-top:10px;color:#00ff00;}
.title-wrapper{text-align:center;margin-top:15vh;font-size:64px;}
.title-line{display:block;animation:slideDown 1s ease forwards;}
@keyframes slideDown{0%{transform:translateY(-100px); opacity:0;}100%{transform:translateY(0); opacity:1;}}
.subtitle{text-align:center;margin-top:20px;font-size:24px;}
#categoryMainBtn{display:block;margin:20px auto 30px auto;background:black;border:4px solid white;color:red;font-family:'Press Start 2P';font-size:24px;padding:20px;width:70%;text-align:center;cursor:pointer;transition:transform 0.15s, box-shadow 0.15s;}
#categoryMainBtn:hover{transform:scale(1.05) rotate(1deg);box-shadow:0 0 12px white;}
.category-panel{display:none;margin:0 auto 30px auto;text-align:center;background:#111;border:4px solid white;padding:20px;width:300px;}
.category-panel button{width:90%;margin:10px 0;padding:14px;font-family:'Press Start 2P';font-size:16px;background:black;color:white;border:3px solid white;cursor:pointer;transition:transform 0.15s;}
.category-panel button:hover{transform:scale(1.1) rotate(1deg);box-shadow:0 0 10px white;}
table{width:95%;margin:20px auto 50px auto;border-collapse:collapse;font-size:16px;display:none;}
th,td{border:3px solid white;padding:12px;text-align:center;position:relative;}
th{background:#222;}
a{color:#00ffcc;text-decoration:none;}
.info-panel{display:none;margin:60px auto;background:#111;border:4px solid white;padding:30px;width:80%;text-align:center;position:relative;}
.close-btn{position:absolute;top:12px;right:16px;font-size:24px;cursor:pointer;}
.close-btn:hover{color:red;}
#logrosList button{width:80%;margin:8px 0;padding:12px;background:#222;color:white;border:3px solid white;cursor:pointer;font-family:'Press Start 2P';}
#logrosList button:hover{transform:scale(1.05);box-shadow:0 0 8px white;}
#miniPlayer{position:fixed;bottom:20px;right:20px;background:#111;border:4px solid white;width:220px;height:220px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;z-index:1000;padding:10px;}
#miniPlayer #currentSong{color:#00ff00;font-family:'Press Start 2P';font-size:18px;text-align:center;}
#miniPlayer .buttonsRow{display:flex;justify-content:space-around;width:100%;}
#miniPlayer .buttonsRow button{background:black;color:white;border:3px solid white;font-family:'Press Start 2P';font-size:18px;cursor:pointer;padding:10px 14px;width:30%;transition:0.2s;}
#miniPlayer .buttonsRow button:hover{transform:scale(1.1);box-shadow:0 0 10px white;}
.top1{animation:glowGold 1s infinite alternate;}
.top2{animation:glowSilver 1s infinite alternate;}
.top3{animation:glowBronze 1s infinite alternate;}
@keyframes glowGold{0%{text-shadow:0 0 5px #FFD700;}100%{text-shadow:0 0 20px #FFD700;}}
@keyframes glowSilver{0%{text-shadow:0 0 5px #C0C0C0;}100%{text-shadow:0 0 20px #C0C0C0;}}
@keyframes glowBronze{0%{text-shadow:0 0 5px #CD7F32;}100%{text-shadow:0 0 20px #CD7F32;}}
</style>
</head>
<body>

<!-- PANEL LOGROS -->
<div class="info-panel" id="logrosPanel">
  <span class="close-btn" onclick="closePanels()">‚úï</span>
  <h3>LOGROS</h3>
  <div id="logrosList"></div>
</div>

<div class="info-panel" id="logroInfoPanel">
  <span class="close-btn" onclick="closePanels()">‚úï</span>
  <h3 id="infoTitle">T√≠tulo del logro</h3>
  <p id="infoDesc">Aqu√≠ va la info de c√≥mo conseguirlo</p>
</div>

<div class="menu" onclick="toggleMenu()">‚ò∞</div>
<div class="menu-panel" id="menuPanel">
  <button onclick="showImport()">Importar Speedruns</button>
  <button onclick="showDeletePanel()">Borrar Speedruns</button>
  <button onclick="showRules()">Contactame</button>
  <button onclick="showLogros()">Logros</button>
  <button id="musicBtn" class="on" onclick="toggleMusic()">M√∫sica ON/OFF</button>
</div>

<div id="currentCategory"></div>

<div class="title-wrapper">
  <span class="title-line">EL PAPU</span>
  <span class="title-line">SPEEDRUNS</span>
</div>

<div class="subtitle">Clasificaci√≥n</div>
<button id="categoryMainBtn" onclick="toggleBigCategory()">Categor√≠as</button>
<div class="category-panel" id="bigCategory">
  <button onclick="firstCategory('lvl11')">1-1 Level</button>
  <button onclick="firstCategory('any')">Any%</button>
  <button onclick="firstCategory('warpless')">Warpless</button>
  <button onclick="firstCategory('moon11')">Moonwalk Jump Solo - 1-1</button>
  <button onclick="firstCategory('moonAny')">Moonwalk Jump Solo - Any%</button>
</div>

<!-- Tablas -->
<table id="lvl11"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="any"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="warpless"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="moon11"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="moonAny"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>

<!-- IMPORTAR PANEL -->
<div class="info-panel" id="importPanel">
<span class="close-btn" onclick="closePanels()">‚úï</span>
<h3>Importar Speedrun</h3>
<input type="password" id="importPass" placeholder="Contrase√±a">
<br><br>
<input type="text" id="playerName" placeholder="Nombre jugador">
<input type="number" id="playerTime" placeholder="Tiempo">
<input type="text" id="playerVideo" placeholder="URL del video">
<select id="runCategory">
  <option value="lvl11">1-1 Level</option>
  <option value="any">Any%</option>
  <option value="warpless">Warpless</option>
  <option value="moon11">Moonwalk Jump Solo - 1-1</option>
  <option value="moonAny">Moonwalk Jump Solo - Any%</option>
</select>
<br><br>
<button onclick="addSpeedrun()">Agregar Speedrun</button>
</div>

<!-- MINI PLAYER -->
<div id="miniPlayer">
  <div id="currentSong">Cargando...</div>
  <div class="buttonsRow">
    <button onclick="prevSong()">‚óÄ</button>
    <button onclick="toggleStop()">‚èπ</button>
    <button onclick="nextSong()">‚ñ∂</button>
  </div>
</div>

<div id="ytPlayerContainer" style="display:none"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-database.js";

// --- FIREBASE CONFIG ---
const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_PROYECTO.firebaseapp.com",
  databaseURL: "https://TU_PROYECTO-default-rtdb.firebaseio.com",
  projectId: "TU_PROYECTO",
  storageBucket: "TU_PROYECTO.appspot.com",
  messagingSenderId: "TU_ID",
  appId: "TU_APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// --- VARIABLES ---
let ytPlayer;
let playlistIndex = 0;
const playlistIds = ['Rrx0F1TzQ0M','NTa6Xbzfq1U','7tTVYfgDf6g']; // tercera canci√≥n primero

const LOGROS = {
  primerRun: { nombre: "Primer Run", unlocked: false },
  sub30: { nombre: "Sub 30", unlocked: false },
  sub20: { nombre: "Sub 20", unlocked: false },
  sub19: { nombre: "Sub 19", unlocked: false },
  grinder: { nombre: "GRANDE DIEGO", unlocked: false },
  secreto: { nombre: "???", unlocked: false },
  pacfan: { nombre: "Pac-Fan", unlocked: false },
  speedrunner: { nombre: "Speedrunner", unlocked: false }
};

// --- MINI PLAYER ---
function onYouTubeIframeAPIReady(){
  ytPlayer = new YT.Player('ytPlayerContainer',{
    height:'0', width:'0',
    videoId: playlistIds[playlistIndex],
    events:{
      'onReady': e=>{ e.target.playVideo(); updateSongTitle(); },
      'onStateChange': e=>{ if(e.data===YT.PlayerState.ENDED) nextSong(); }
    }
  });
}
function updateSongTitle(){ document.getElementById("currentSong").innerText="üéµ "+playlistIds[playlistIndex]; }
function nextSong(){ playlistIndex=(playlistIndex+1)%playlistIds.length; ytPlayer.loadVideoById(playlistIds[playlistIndex]); updateSongTitle(); }
function prevSong(){ playlistIndex=(playlistIndex-1+playlistIds.length)%playlistIds.length; ytPlayer.loadVideoById(playlistIds[playlistIndex]); updateSongTitle(); }
function toggleStop(){ if(ytPlayer.getPlayerState()===1) ytPlayer.pauseVideo(); else ytPlayer.playVideo(); }
function toggleMusic(){ toggleStop(); }

// --- MEN√ö Y CATEGORIAS ---
const currentCategoryDiv = document.getElementById("currentCategory");
const menuPanel=document.getElementById("menuPanel");
const bigCategory=document.getElementById("bigCategory");
function toggleMenu(){ menuPanel.style.display = menuPanel.style.display==="block"?"none":"block"; }
function toggleBigCategory(){ bigCategory.style.display = bigCategory.style.display==="block"?"none":"block"; }
function firstCategory(id){ bigCategory.style.display="none"; showCategory(id); }
function showCategory(id){
  hideAll();
  const tbl=document.getElementById(id);
  tbl.style.display="table";
  listenSpeedruns(id);
  const names = { lvl11:"1-1 Level", any:"Any%", warpless:"Warpless", moon11:"Moonwalk Jump Solo - 1-1", moonAny:"Moonwalk Jump Solo - Any%" };
  currentCategoryDiv.innerText = names[id] || "";
  tbl.scrollIntoView({behavior:"smooth"});
}
function hideAll(){ [...document.querySelectorAll("table")].forEach(t=>t.style.display="none"); [...document.querySelectorAll(".info-panel")].forEach(p=>p.style.display="none"); }

// --- FIREBASE SPEEDRUNS ---
function listenSpeedruns(category){
  const table=document.getElementById(category);
  const speedrunRef = ref(db,'speedruns/'+category);
  onValue(speedrunRef, snapshot=>{
    table.innerHTML = `<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>`;
    const data = snapshot.val();
    if(!data) return;
    const runs = Object.values(data).map(r=>({name:r.name,time:parseFloat(r.time),video:r.video||''}));
    runs.sort((a,b)=>a.time-b.time);
    runs.forEach((run,i)=>{
      const row=document.createElement('tr');
      row.innerHTML=`<td>${i+1}</td><td>${run.name}</td><td>${run.time.toFixed(2)}</td><td>Custom</td><td>${run.video?`<a href="${run.video}" target="_blank">VER</a>`:'--'}</td>`;
      table.appendChild(row);
    });
  });
}

// --- AGREGAR SPEEDRUN ---
function addSpeedrun(){
  const pass=document.getElementById('importPass').value;
  if(pass!=="ELPAPUESPRO"){ alert("Contrase√±a incorrecta"); return; }
  const name=document.getElementById('playerName').value.trim();
  const time=parseFloat(document.getElementById('playerTime').value);
  const video=document.getElementById('playerVideo').value.trim();
  const category=document.getElementById('runCategory').value;
  if(!name || isNaN(time)){ alert("Completa todos los campos correctamente"); return; }
  push(ref(db,'speedruns/'+category),{name,time,video});
  checkLogros(time);
  document.getElementById('playerName').value=""; document.getElementById('playerTime').value=""; document.getElementById('playerVideo').value=""; document.getElementById('importPass').value=""; document.getElementById('importPanel').style.display="none";
}

// --- LOGROS ---
function loadLogros(){
  const saved=JSON.parse(localStorage.getItem("papuLogros"));
  if(saved) for(const k in LOGROS) if(saved[k]!==undefined) LOGROS[k].unlocked=saved[k];
}
function saveLogros(){ localStorage.setItem("papuLogros",JSON.stringify(LOGROS)); }
function showLogros(){ hideAll(); menuPanel.style.display="none"; const list=document.getElementById("logrosList"); list.innerHTML=""; for(const key in LOGROS){ const btn=document.createElement("button"); btn.innerText=LOGROS[key].unlocked?LOGROS[key].nombre:"-----------"; btn.onclick=()=>showLogroInfo(key); list.appendChild(btn);} document.getElementById("logrosPanel").style.display="block"; }
function showLogroInfo(key){ hideAll(); document.getElementById("logroInfoPanel").style.display="block"; document.getElementById("infoTitle").innerText=LOGROS[key].nombre; const descs={primerRun:"Haz tu primer run.",sub30:"Completa un run en 20-30s.",sub20:"Completa un run entre 18.30-19.99s.",sub19:"Completa un run <19s.",grinder:"Agrega 10 runs.",secreto:"???",pacfan:"Completa un run relacionado con Pac-Man.",speedrunner:"1-1 entre 18-19s y Any% <5min."}; document.getElementById("infoDesc").innerText=descs[key]; }
function checkLogros(time){ if(!LOGROS.primerRun.unlocked) LOGROS.primerRun.unlocked=true; if(time>=20 && time<=30) LOGROS.sub30.unlocked=true; if(time>=18.3 && time<=19.99) LOGROS.sub20.unlocked=true; if(time<19) LOGROS.sub19.unlocked=true; saveLogros(); }

// --- BORRAR SPEEDRUN ---
function showDeletePanel(){
  const visibleTable=[...document.querySelectorAll("table")].find(t=>t.style.display==="table");
  if(!visibleTable||visibleTable.rows.length<=1){ alert("No hay runs visibles para borrar"); return; }

  const rows = [...visibleTable.rows].slice(1);
  const list = rows.map((r,i) => `${i+1}: ${r.cells[1].innerText} - ${r.cells[2].innerText}`).join("\n");
  const sel = prompt("Selecciona el n√∫mero del run a borrar:\n"+list);
  const index = parseInt(sel)-1;
  if(isNaN(index) || index<0 || index>=rows.length){ alert("Selecci√≥n inv√°lida"); return; }

  const pass = prompt("Introduce contrase√±a para borrar:");
  if(pass !== "ELPAPUESPRO"){ alert("Contrase√±a incorrecta"); return; }

  // Para borrar en Firebase necesitamos la key
  const category = visibleTable.id;
  const speedrunRef = ref(db,'speedruns/'+category);
  onValue(speedrunRef, snapshot => {
    const data = snapshot.val();
    if(!data) return;
    const keys = Object.keys(data);
    remove(ref(db,'speedruns/'+category+'/'+keys[index]));
  }, {once:true});
}

// --- PANELES ---
function showImport(){ hideAll(); document.getElementById('importPanel').style.display='block'; menuPanel.style.display='none'; }
function showRules(){ alert("Contactame en: elpapu3388@gmail.com"); }
function closePanels(){ hideAll(); }

// --- INICIALIZACION ---
window.onload = ()=>{
  loadLogros();
  showCategory('lvl11'); // mostrar la tercera canci√≥n primero ya est√° en playlistIndex
};
</script>

<script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
