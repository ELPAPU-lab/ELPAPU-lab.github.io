<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PAPU Speedruns</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body{
  background:black;
  color:white;
  margin:0;
  font-family:'Press Start 2P', monospace;
  overflow-x:hidden;
  position:relative;
}

/* ---------- FONDO ANIMADO NES ---------- */
body::before{
  content:"";
  position:fixed;
  top:0;
  left:0;
  width:200%;
  height:200%;
  background-image:repeating-linear-gradient(45deg,#222 0 1px,#111 1px 2px);
  z-index:-1;
  animation:bgMove 20s linear infinite;
}
@keyframes bgMove{
  0%{transform:translate(0,0);}
  50%{transform:translate(-50px,50px);}
  100%{transform:translate(0,0);}
}

/* ---------- MENU ---------- */
.menu{
  position:fixed;
  top:20px;
  right:30px;
  font-size:48px;
  cursor:pointer;
  z-index:100;
}
.menu-panel{
  display:none;
  position:fixed;
  top:90px;
  right:30px;
  background:#111;
  border:4px solid white;
  padding:20px;
  width:320px;
  z-index:100;
}
.menu-panel button{
  width:100%;
  margin-bottom:12px;
  padding:14px;
  font-family:'Press Start 2P';
  font-size:14px;
  background:black;
  color:white;
  border:3px solid white;
  cursor:pointer;
  transition:transform 0.15s, box-shadow 0.15s;
}
.menu-panel button:hover{
  transform:scale(1.05) rotate(-1deg);
  box-shadow:0 0 12px white;
}

/* ---------- CATEGOR√çA ACTUAL ---------- */
#currentCategory{
  text-align:center;
  font-size:28px;
  margin-top:10px;
  color:#00ff00;
}

/* ---------- TITULO ---------- */
.title-wrapper{
  text-align:center;
  margin-top:15vh;
  font-size:64px;
}
.title-line{
  display:block;
  animation:slideDown 1s ease forwards;
}
@keyframes slideDown{
  0%{transform:translateY(-100px); opacity:0;}
  100%{transform:translateY(0); opacity:1;}
}
.subtitle{
  text-align:center;
  margin-top:20px;
  font-size:24px;
}

/* ---------- BOTON CATEGORIAS ---------- */
#categoryMainBtn{
  display:block;
  margin:20px auto 30px auto;
  background:black;
  border:4px solid white;
  color:red;
  font-family:'Press Start 2P';
  font-size:24px;
  padding:20px;
  width:70%;
  text-align:center;
  cursor:pointer;
  transition:transform 0.15s, box-shadow 0.15s;
}
#categoryMainBtn:hover{
  transform:scale(1.05) rotate(1deg);
  box-shadow:0 0 12px white;
}

/* ---------- CATEGORY PANEL ---------- */
.category-panel{
  display:none;
  margin:0 auto 30px auto;
  text-align:center;
  background:#111;
  border:4px solid white;
  padding:20px;
  width:300px;
}
.category-panel button{
  width:90%;
  margin:10px 0;
  padding:14px;
  font-family:'Press Start 2P';
  font-size:16px;
  background:black;
  color:white;
  border:3px solid white;
  cursor:pointer;
  transition:transform 0.15s;
}
.category-panel button:hover{
  transform:scale(1.1) rotate(1deg);
  box-shadow:0 0 10px white;
}

/* ---------- TABLAS ---------- */
table{
  width:95%;
  margin:20px auto 50px auto;
  border-collapse:collapse;
  font-size:16px;
  display:none;
}
th,td{
  border:3px solid white;
  padding:12px;
  text-align:center;
  position:relative;
}
th{background:#222;}
a{color:#00ffcc;text-decoration:none;}

/* ---------- INFO PANELS ---------- */
.info-panel{
  display:none;
  margin:60px auto;
  background:#111;
  border:4px solid white;
  padding:30px;
  width:80%;
  text-align:center;
  position:relative;
}
.close-btn{
  position:absolute;
  top:12px;
  right:16px;
  font-size:24px;
  cursor:pointer;
}
.close-btn:hover{color:red;}

/* ---------- CUADRO M√öSICA ARRIBA ---------- */
#songName{
  display:none;
  position:fixed;
  top:20px;
  right:30px;
  background:#222;
  color:#00ff00;
  border:4px solid white;
  padding:20px;
  font-family:'Press Start 2P';
  font-size:16px;
  z-index:1000;
  opacity:0;
  animation:fadeInOut 5s forwards;
}
@keyframes fadeInOut{
  0%{opacity:0;transform:translateY(-20px);}
  10%{opacity:1;transform:translateY(0);}
  90%{opacity:1;transform:translateY(0);}
  100%{opacity:0;transform:translateY(-20px);}
}

/* ---------- MINI PLAYER ---------- */
#miniPlayer{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#111;
  border:4px solid white;
  width:220px;
  height:220px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
  z-index:1000;
  padding:10px;
}
#miniPlayer #currentSong{
  color:#00ff00;
  font-family:'Press Start 2P';
  font-size:18px;
  text-align:center;
}
#miniPlayer .buttonsRow{
  display:flex;
  justify-content:space-around;
  width:100%;
}
#miniPlayer .buttonsRow button{
  background:black;
  color:white;
  border:3px solid white;
  font-family:'Press Start 2P';
  font-size:18px;
  cursor:pointer;
  padding:10px 14px;
  width:30%;
  transition:0.2s;
}
#miniPlayer .buttonsRow button:hover{
  transform:scale(1.1);
  box-shadow:0 0 10px white;
}

/* ---------- MINI CONTADOR DE PISTAS ---------- */
#trackCounter{
  margin-top:10px;
  color:#00ff00;
  font-family:'Press Start 2P';
  font-size:14px;
  text-align:center;
}

/* ---------- RESALTAR 1¬∞,2¬∞,3¬∞ ---------- */
.top1{animation:glowGold 1s infinite alternate;}
.top2{animation:glowSilver 1s infinite alternate;}
.top3{animation:glowBronze 1s infinite alternate;}
@keyframes glowGold{0%{text-shadow:0 0 5px #FFD700;}100%{text-shadow:0 0 20px #FFD700;}}
@keyframes glowSilver{0%{text-shadow:0 0 5px #C0C0C0;}100%{text-shadow:0 0 20px #C0C0C0;}}
@keyframes glowBronze{0%{text-shadow:0 0 5px #CD7F32;}100%{text-shadow:0 0 20px #CD7F32;}}
</style>
</head>
<body>
<div class="info-panel" id="logrosPanel">
  <span class="close-btn" onclick="closePanels()">‚úï</span>
  <h3>LOGROS</h3>
  <p>Aqu√≠ ir√°n tus logros</p>
</div>

<div class="menu" onclick="toggleMenu()">‚ò∞</div>
<div class="menu-panel" id="menuPanel">
  <button id="menuCatBtn" class="on" onclick="toggleCategories()" style="display:none">Categor√≠as</button>
  <button onclick="showImport()">Importar Speedruns</button>
  <button onclick="showDeletePanel()">Borrar Speedruns</button>
  <button onclick="showRules()">Contactame</button>
  <button onclick="showLogros()">Logros</button>
  <button id="musicBtn" class="on" onclick="toggleMusic()">M√∫sica ON/OFF</button>
</div>

<!-- NUEVO DIV PARA CATEGOR√çA ACTUAL -->
<div id="currentCategory"></div>

<div class="title-wrapper">
  <span class="title-line">EL PAPU</span>
  <span class="title-line">SPEEDRUNS</span>
</div>

<div class="subtitle">Clasificaci√≥n</div>
<button id="categoryMainBtn" onclick="toggleBigCategory()">Categor√≠as</button>
<div class="category-panel" id="bigCategory">
  <button onclick="firstCategory('lvl11')">1-1 Level</button>
  <button onclick="firstCategory('any')">Any%</button>
  <button onclick="firstCategory('warpless')">Warpless</button>
  <button onclick="firstCategory('moon11')">Moonwalk Jump Solo - 1-1</button>
  <button onclick="firstCategory('moonAny')">Moonwalk Jump Solo - Any%</button>
</div>

<!-- Tablas -->
<table id="lvl11">
<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>
</table>
<table id="any">
<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>
</table>
<table id="warpless">
<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>
</table>
<table id="moon11">
<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>
</table>
<table id="moonAny">
<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>
</table>

<!-- IMPORTAR SPEEDRUN PANEL -->
<div class="info-panel" id="importPanel">
<span class="close-btn" onclick="closePanels()">‚úï</span>
<h3>Importar Speedrun</h3>
<input type="password" id="importPass" placeholder="Contrase√±a">
<br><br>
<input type="text" id="playerName" placeholder="Nombre jugador">
<input type="number" id="playerTime" placeholder="Tiempo">
<input type="text" id="playerVideo" placeholder="URL del video">
<select id="runCategory">
  <option value="lvl11">1-1 Level</option>
  <option value="any">Any%</option>
  <option value="warpless">Warpless</option>
  <option value="moon11">Moonwalk Jump Solo - 1-1</option>
  <option value="moonAny">Moonwalk Jump Solo - Any%</option>
</select>
<br><br>
<button onclick="addSpeedrun()">Agregar Speedrun</button>
</div>

<!-- MINI PLAYER -->
<div id="miniPlayer">
  <div id="currentSong">Cargando...</div>
  <div class="buttonsRow">
    <button onclick="prevSong()">‚óÄ</button>
    <button onclick="toggleStop()">‚èπ</button>
    <button onclick="nextSong()">‚ñ∂</button>
  </div>
  <div id="trackCounter">1 / 7</div>
</div>

<div id="songName"></div>
<div id="warnMsg"></div>

<iframe id="ytPlayer" width="0" height="0"
src="https://www.youtube.com/embed/NTa6Xbzfq1U?autoplay=1&enablejsapi=1"
frameborder="0" allow="autoplay" allowfullscreen></iframe>

<script>
const importPanel = document.getElementById("importPanel");
const rulesPanel = document.getElementById("rulesPanel"); // o crea un div
  
  function showLogros(){
  hideAll();
  document.getElementById("logrosPanel").style.display = "block";
  menuPanel.style.display = "none";
}

const LOGROS = {
  primerRun: { nombre: "Primer Run", unlocked: false },
  sub30: { nombre: "Sub 30", unlocked: false },
  sub20: { nombre: "Sub 20", unlocked: false },
  sub19: { nombre: "Sub 19", unlocked: false },
  pixelPerfect: { nombre: "Pixel Perfect", unlocked: false },

  grinder: { nombre: "Grinder", unlocked: false },
  unaMas: { nombre: "Una M√°s", unlocked: false },

  sofa: { nombre: "Speedrunner de Sof√°", unlocked: false },

  secreto: { nombre: "???", unlocked: false },
  pacfan: { nombre: "Pac-Fan", unlocked: false }
};

function loadLogros(){
  const saved = JSON.parse(localStorage.getItem("papuLogros"));
  if(saved){
    for(const key in LOGROS){
      if(saved[key] !== undefined){
        LOGROS[key].unlocked = saved[key];
      }
    }
  }
}

function saveLogros(){
  const data = {};
  for(const key in LOGROS){
    data[key] = LOGROS[key].unlocked;
  }
  localStorage.setItem("papuLogros", JSON.stringify(data));
}

  
</script>

<script>
/* -------------------- Variables -------------------- */
let ytPlayer;
let musicOn = true;
let stopActive = false;
let playlistIndex = 0;
let playlistIds = ['NTa6Xbzfq1U','7tTVYfgDf6g','Rrx0F1TzQ0M','7hG-96NiMXU','3GqWF2a-fo8','3H220odl1D4','EMUh6vPjBXc','VXdCEKIQiGE','KK3KXAECte4','kL8CyVqzmkc','osPq9Yb8xm8'];

const currentSong = document.getElementById('currentSong');
const songName = document.getElementById('songName');
const trackCounter = document.getElementById('trackCounter');
const musicBtn = document.getElementById('musicBtn');

const menuPanel=document.getElementById("menuPanel");
const bigCategory=document.getElementById("bigCategory");
const menuCatBtn=document.getElementById("menuCatBtn");
const currentCategoryDiv = document.getElementById("currentCategory");

/* -------------------- Funciones Mini Player -------------------- */
function onYouTubeIframeAPIReady() {
  ytPlayer = new YT.Player('ytPlayer', {
    events: {
      'onReady': () => {
        ytPlayer.playVideo();
        setTimeout(updateSongDisplay, 500);
      },
      'onStateChange': (event) => {
        if(event.data === YT.PlayerState.ENDED){
          nextSong();
        } else if(event.data === YT.PlayerState.PLAYING){
          setTimeout(updateSongDisplay, 200);
        }
      }
    }
  });
}
function updateSongDisplay(){
  if(!ytPlayer || !ytPlayer.getVideoData) return;
  const data = ytPlayer.getVideoData();
  const title = data.title || "Canci√≥n";
  currentSong.innerText = title;
  songName.innerText = "Est√°s escuchando: " + title;
  songName.style.display = "block";
  songName.style.animation = "fadeInOut 5s forwards";
  trackCounter.innerText = (playlistIndex+1) + " / " + playlistIds.length;
}
function toggleMusic(){
  if(!ytPlayer) return;
  if(musicOn){ ytPlayer.pauseVideo(); musicOn=false; musicBtn.className="off"; stopActive=true; }
  else{ ytPlayer.playVideo(); musicOn=true; musicBtn.className="on"; stopActive=false; }
}
function toggleStop(){
  if(!ytPlayer) return;
  if(!stopActive){ ytPlayer.pauseVideo(); stopActive=true; }
  else{ ytPlayer.playVideo(); stopActive=false; }
}
function nextSong(){
  playlistIndex = (playlistIndex + 1) % playlistIds.length;
  ytPlayer.loadVideoById(playlistIds[playlistIndex]);
  setTimeout(updateSongDisplay, 500);
}
function prevSong(){
  playlistIndex = (playlistIndex - 1 + playlistIds.length) % playlistIds.length;
  ytPlayer.loadVideoById(playlistIds[playlistIndex]);
  setTimeout(updateSongDisplay, 500);
}

/* -------------------- Men√∫ y Categor√≠as -------------------- */
function toggleMenu(){ menuPanel.style.display = menuPanel.style.display==="block"?"none":"block"; }
function toggleCategories(){ bigCategory.style.display = bigCategory.style.display==="block"?"none":"block"; }
function toggleBigCategory(){ bigCategory.style.display = bigCategory.style.display==="block"?"none":"block"; }
function firstCategory(id){ bigCategory.style.display="none"; menuCatBtn.style.display="block"; showCategory(id); }
function showCategory(id){
  hideAll();
  const tbl=document.getElementById(id);
  tbl.style.display="table";
  sortTable(tbl);
  menuPanel.style.display="none";
  bigCategory.style.display="none";
  tbl.scrollIntoView({behavior:"smooth"});
  
  // Actualizar nombre de categor√≠a
  const names = {
    lvl11: "1-1 Level",
    any: "Any%",
    warpless: "Warpless",
    moon11: "Moonwalk Jump Solo - 1-1",
    moonAny: "Moonwalk Jump Solo - Any%"
  };
  currentCategoryDiv.innerText = names[id] || "";
}
function hideAll(){
  [...document.querySelectorAll("table")].forEach(t=>t.style.display="none");
  [...document.querySelectorAll(".info-panel")].forEach(p=>p.style.display="none");
  }
/* -------------------- Speedruns -------------------- */
function loadRuns(){
  const saved=JSON.parse(localStorage.getItem('papuSpeedruns')||'{}');
  for(const cat in saved){
    const table=document.getElementById(cat);
    saved[cat].forEach(run=>{
      const row=document.createElement('tr');
      row.innerHTML=`<td></td><td>${run.name}</td><td>${run.time.toFixed(2)}</td><td>${run.platform}</td><td>${run.video ? `<a href="${run.video}" target="_blank">VER</a>` : '--'}</td>`;
      table.appendChild(row);
    });
    sortTable(table);
  }
}
function saveRuns(){
  const data={};
  [...document.querySelectorAll("table")].forEach(table=>{
    data[table.id]=[...table.rows].slice(1).map(r=>({
      name:r.cells[1].innerText,
      time:parseFloat(r.cells[2].innerText),
      platform:r.cells[3].innerText,
      video:r.cells[4].querySelector('a') ? r.cells[4].querySelector('a').href : ''
    }));
  });
  localStorage.setItem('papuSpeedruns',JSON.stringify(data));
}

/* -------------------- Importar Speedrun -------------------- */
function addSpeedrun(){
  const pass=document.getElementById('importPass').value;
  if(pass!=="ELPAPUESPRO"){ alert("Contrase√±a incorrecta"); return; }
  const name=document.getElementById('playerName').value.trim();
  const time=parseFloat(document.getElementById('playerTime').value);
  const video=document.getElementById('playerVideo').value.trim();
  const category=document.getElementById('runCategory').value;
  if(!name||!time){ alert("Completa todos los campos"); return; }

  const table=document.getElementById(category);
  const row=document.createElement('tr');
  row.innerHTML=`<td></td><td>${name}</td><td>${time.toFixed(2)}</td><td>Custom</td><td>${video ? `<a href="${video}" target="_blank">VER</a>` : '--'}</td>`;
  table.appendChild(row);
  sortTable(table);
  saveRuns();
  
  // Limpiar campos
  document.getElementById('playerName').value="";
  document.getElementById('playerTime').value="";
  document.getElementById('playerVideo').value="";
  document.getElementById('importPass').value="";
  importPanel.style.display="none";
  
function checkLogros(time, category){
  unlock('primerRun');
  if(time < 30) unlock('sub30');
  if(time < 20) unlock('sub20');
  if(time < 19) unlock('sub19');
  saveLogros();
}

function unlock(id){
  if(!LOGROS[id].unlocked){
    LOGROS[id].unlocked = true;
    alert("üèÜ LOGRO DESBLOQUEADO: " + LOGROS[id].nombre);
  }
/* -------------------- Borrar Speedrun -------------------- */
let runToDelete = null;

function showDeletePanel(){
  const visibleTable = [...document.querySelectorAll("table")].find(t => t.style.display==="table");
  if(!visibleTable || visibleTable.rows.length<=1){ alert("No hay runs visibles para borrar"); return; }
  
  runToDelete = null;
  const rows = [...visibleTable.rows].slice(1);
  const list = rows.map((r,i)=>`${i+1}: ${r.cells[1].innerText} - ${r.cells[2].innerText}`).join("\n");
  const sel = prompt("Selecciona el n√∫mero del run a borrar:\n" + list);
  const index = parseInt(sel)-1;
  if(isNaN(index) || index<0 || index>=rows.length){ alert("Selecci√≥n inv√°lida"); return; }
  runToDelete = rows[index];
  
  const pass = prompt("Introduce contrase√±a para borrar:");
  if(pass !== "ELPAPUESPRO"){ alert("Contrase√±a incorrecta"); runToDelete=null; return; }
  
  const confirmDelete = confirm("REALMENTE QUIERES BORRAR ESTE RUN?, NO PODR√ÅS RECUPERARLO JAM√ÅS BRO :V");
  if(confirmDelete){ 
    runToDelete.remove();
    saveRuns();
    alert("Run borrado exitosamente"); 
  } else { runToDelete=null; }
}

/* -------------------- Ordenar Tablas -------------------- */
function sortTable(table){
  const rows = [...table.rows].slice(1);
  rows.sort((a,b)=>parseFloat(a.cells[2].innerText) - parseFloat(b.cells[2].innerText));
  rows.forEach((r,i)=>{
    r.classList.remove("top1","top2","top3");
    if(i===0) r.classList.add("top1");
    if(i===1) r.classList.add("top2");
    if(i===2) r.classList.add("top3");
    r.cells[0].innerText = i+1;
    table.appendChild(r);
  });
}

/* -------------------- Panels -------------------- */
function showImport(){ hideAll(); importPanel.style.display='block'; menuPanel.style.display='none'; }
function showRules(){ alert("Contactame en elpapu3388@gmail.com"); }
function closePanels(){ hideAll(); }

/* -------------------- Inicializaci√≥n -------------------- */
window.onload = ()=>{
  loadRuns();
  loadLogros();
  showCategory('lvl11');
  }

</script>
<script src="https://www.youtube.com/iframe_api"></script>

<div class="info-panel" id="rulesPanel">
  <span class="close-btn" onclick="closePanels()">‚úï</span>
  <h3>Contactame</h3>
  <p>Escribime a: elpapu3388@gmail.com</p>
</div>

</body>
</html>
