<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PAPU Speedruns</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body{
  background:black;
  color:white;
  margin:0;
  font-family:'Press Start 2P', monospace;
  overflow-x:hidden;
  position:relative;
}

body::before{
  content:"";
  position:fixed;
  top:0;
  left:0;
  width:200%;
  height:200%;
  background-image:repeating-linear-gradient(45deg,#222 0 1px,#111 1px 2px);
  z-index:-1;
  animation:bgMove 20s linear infinite;
}
@keyframes bgMove{
  0%{transform:translate(0,0);}
  50%{transform:translate(-50px,50px);}
  100%{transform:translate(0,0);}
}

/* Menu y paneles */
.menu{
  position:fixed;
  top:20px;
  right:30px;
  font-size:48px;
  cursor:pointer;
  z-index:100;
}
.menu-panel{
  display:none;
  position:fixed;
  top:90px;
  right:30px;
  background:#111;
  border:4px solid white;
  padding:20px;
  width:320px;
  z-index:100;
}
.menu-panel button{
  width:100%;
  margin-bottom:12px;
  padding:14px;
  font-family:'Press Start 2P';
  font-size:14px;
  background:black;
  color:white;
  border:3px solid white;
  cursor:pointer;
  transition:transform 0.15s, box-shadow 0.15s;
}
.menu-panel button:hover{
  transform:scale(1.05) rotate(-1deg);
  box-shadow:0 0 12px white;
}

/* Categor√≠as y tablas */
#currentCategory{text-align:center;font-size:28px;margin-top:10px;color:#00ff00;}
.title-wrapper{text-align:center;margin-top:15vh;font-size:64px;}
.title-line{display:block;animation:slideDown 1s ease forwards;}
@keyframes slideDown{0%{transform:translateY(-100px); opacity:0;}100%{transform:translateY(0); opacity:1;}}
.subtitle{text-align:center;margin-top:20px;font-size:24px;}
#categoryMainBtn{display:block;margin:20px auto 30px auto;background:black;border:4px solid white;color:red;font-family:'Press Start 2P';font-size:24px;padding:20px;width:70%;text-align:center;cursor:pointer;transition:transform 0.15s, box-shadow 0.15s;}
#categoryMainBtn:hover{transform:scale(1.05) rotate(1deg);box-shadow:0 0 12px white;}
.category-panel{display:none;margin:0 auto 30px auto;text-align:center;background:#111;border:4px solid white;padding:20px;width:300px;}
.category-panel button{width:90%;margin:10px 0;padding:14px;font-family:'Press Start 2P';font-size:16px;background:black;color:white;border:3px solid white;cursor:pointer;transition:transform 0.15s;}
.category-panel button:hover{transform:scale(1.1) rotate(1deg);box-shadow:0 0 10px white;}
table{width:95%;margin:20px auto 50px auto;border-collapse:collapse;font-size:16px;display:none;}
th,td{border:3px solid white;padding:12px;text-align:center;position:relative;}
th{background:#222;}
a{color:#00ffcc;text-decoration:none;}
.info-panel{display:none;margin:60px auto;background:#111;border:4px solid white;padding:30px;width:80%;text-align:center;position:relative;}
.close-btn{position:absolute;top:12px;right:16px;font-size:24px;cursor:pointer;}
.close-btn:hover{color:red;}
#miniPlayer{position:fixed;bottom:20px;right:20px;background:#111;border:4px solid white;width:220px;height:220px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;z-index:1000;padding:10px;}
#miniPlayer .buttonsRow{display:flex;justify-content:space-around;width:100%;}
#miniPlayer .buttonsRow button{background:black;color:white;border:3px solid white;font-family:'Press Start 2P';font-size:18px;cursor:pointer;padding:10px 14px;width:30%;transition:0.2s;}
#miniPlayer .buttonsRow button:hover{transform:scale(1.1);box-shadow:0 0 10px white;}
.top1{animation:glowGold 1s infinite alternate;}
.top2{animation:glowSilver 1s infinite alternate;}
.top3{animation:glowBronze 1s infinite alternate;}
@keyframes glowGold{0%{text-shadow:0 0 5px #FFD700;}100%{text-shadow:0 0 20px #FFD700;}}
@keyframes glowSilver{0%{text-shadow:0 0 5px #C0C0C0;}100%{text-shadow:0 0 20px #C0C0C0;}}
@keyframes glowBronze{0%{text-shadow:0 0 5px #CD7F32;}100%{text-shadow:0 0 20px #CD7F32;}}
</style>
</head>
<body>

<!-- Paneles -->
<div class="info-panel" id="logrosPanel">
  <span class="close-btn" onclick="closePanels()">‚úï</span>
  <h3>LOGROS</h3>
  <div id="logrosList"></div>
</div>

<div class="info-panel" id="logroInfoPanel">
  <span class="close-btn" onclick="closePanels()">‚úï</span>
  <h3 id="infoTitle">---</h3>
  <p id="infoDesc">Aqu√≠ se mostrar√° c√≥mo conseguir el logro</p>
</div>

<div class="menu" onclick="toggleMenu()">‚ò∞</div>
<div class="menu-panel" id="menuPanel">
  <button onclick="showImport()">Importar Speedruns</button>
  <button onclick="showDeletePanel()">Borrar Speedruns</button>
  <button onclick="showRules()">Contactame</button>
  <button onclick="showLogros()">Logros</button>
  <button id="musicBtn" onclick="toggleMusic()">M√∫sica ON/OFF</button>
</div>

<div id="currentCategory"></div>

<div class="title-wrapper">
  <span class="title-line">EL PAPU</span>
  <span class="title-line">SPEEDRUNS</span>
</div>

<div class="subtitle">Clasificaci√≥n</div>
<button id="categoryMainBtn" onclick="toggleBigCategory()">Categor√≠as</button>
<div class="category-panel" id="bigCategory">
  <button onclick="firstCategory('lvl11')">1-1 Level</button>
  <button onclick="firstCategory('any')">Any%</button>
  <button onclick="firstCategory('warpless')">Warpless</button>
  <button onclick="firstCategory('moon11')">Moonwalk Jump Solo - 1-1</button>
  <button onclick="firstCategory('moonAny')">Moonwalk Jump Solo - Any%</button>
</div>

<!-- Tablas -->
<table id="lvl11"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="any"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="warpless"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="moon11"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="moonAny"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>

<!-- IMPORTAR SPEEDRUN -->
<div class="info-panel" id="importPanel">
  <span class="close-btn" onclick="closePanels()">‚úï</span>
  <h3>Importar Speedrun</h3>
  <input type="password" id="importPass" placeholder="Contrase√±a"><br><br>
  <input type="text" id="playerName" placeholder="Nombre jugador">
  <input type="number" id="playerTime" placeholder="Tiempo">
  <input type="text" id="playerVideo" placeholder="URL del video">
  <select id="runCategory">
    <option value="lvl11">1-1 Level</option>
    <option value="any">Any%</option>
    <option value="warpless">Warpless</option>
    <option value="moon11">Moonwalk Jump Solo - 1-1</option>
    <option value="moonAny">Moonwalk Jump Solo - Any%</option>
  </select><br><br>
  <button onclick="addSpeedrun()">Agregar Speedrun</button>
</div>

<!-- MINI PLAYER -->
<div id="miniPlayer">
  <div class="buttonsRow">
    <button onclick="prevSong()">‚óÄ</button>
    <button onclick="toggleStop()">‚èπ</button>
    <button onclick="nextSong()">‚ñ∂</button>
  </div>
  <div id="trackCounter">1 / 7</div>
</div>

<iframe id="ytPlayer" width="0" height="0" src="https://www.youtube.com/embed/NTa6Xbzfq1U?autoplay=1&enablejsapi=1" frameborder="0" allow="autoplay" allowfullscreen></iframe>

<script>
/* -------------------- VARIABLES -------------------- */
const menuPanel=document.getElementById("menuPanel");
const bigCategory=document.getElementById("bigCategory");
const currentCategoryDiv=document.getElementById("currentCategory");
const importPanel=document.getElementById("importPanel");
const LOGROS={
  primerRun:{nombre:"Primer Run",unlocked:false},
  sub30:{nombre:"Sub 30",unlocked:false},
  sub20:{nombre:"Sub 20",unlocked:false},
  sub19:{nombre:"Sub 19",unlocked:false},
  grinder:{nombre:"GRANDE DIEGO",unlocked:false},
  secreto:{nombre:"???",unlocked:false},
  pacfan:{nombre:"Pac-Fan",unlocked:false}
};
let ytPlayer, musicOn=true, stopActive=false, playlistIndex=0;
let playlistIds=['NTa6Xbzfq1U','7tTVYfgDf6g','Rrx0F1TzQ0M','7hG-96NiMXU','3GqWF2a-fo8','3H220odl1D4','EMUh6vPjBXc','VXdCEKIQiGE','KK3KXAECte4','kL8CyVqzmkc','osPq9Yb8xm8'];
const trackCounter=document.getElementById('trackCounter');

/* -------------------- FUNCIONES -------------------- */
function hideAll(){ [...document.querySelectorAll("table")].forEach(t=>t.style.display="none"); [...document.querySelectorAll(".info-panel")].forEach(p=>p.style.display="none"); }
function toggleMenu(){menuPanel.style.display=menuPanel.style.display==="block"?"none":"block";}
function toggleBigCategory(){bigCategory.style.display=bigCategory.style.display==="block"?"none":"block";}
function firstCategory(id){ bigCategory.style.display="none"; showCategory(id);}
function showCategory(id){
  hideAll();
  const tbl=document.getElementById(id);
  tbl.style.display="table";
  sortTable(tbl);
  menuPanel.style.display="none"; bigCategory.style.display="none";
  const names={lvl11:"1-1 Level",any:"Any%",warpless:"Warpless",moon11:"Moonwalk Jump Solo - 1-1",moonAny:"Moonwalk Jump Solo - Any%"};
  currentCategoryDiv.innerText=names[id]||"";
}
function showImport(){ hideAll(); importPanel.style.display="block"; menuPanel.style.display="none"; }
function showRules(){ alert("Contactame en: elpapu3388@gmail.com"); }
function closePanels(){ hideAll(); }

/* -------------------- SPEEDRUNS -------------------- */
function loadRuns(){
  const saved=JSON.parse(localStorage.getItem('papuSpeedruns')||'{}');
  for(const cat in saved){
    const table=document.getElementById(cat);
    saved[cat].forEach(run=>{
      const row=document.createElement('tr');
      row.innerHTML=`<td></td><td>${run.name}</td><td>${run.time.toFixed(2)}</td><td>${run.platform}</td><td>${run.video? `<a href="${run.video}" target="_blank">VER</a>`:'--'}</td>`;
      table.appendChild(row);
    });
    sortTable(table);
  }
}
function saveRuns(){
  const data={};
  [...document.querySelectorAll("table")].forEach(table=>{
    data[table.id]=[...table.rows].slice(1).map(r=>({
      name:r.cells[1].innerText,
      time:parseFloat(r.cells[2].innerText),
      platform:r.cells[3].innerText,
      video:r.cells[4].querySelector('a')? r.cells[4].querySelector('a').href:''
    }));
  });
  localStorage.setItem('papuSpeedruns',JSON.stringify(data));
}
function addSpeedrun(){
  const pass=document.getElementById('importPass').value;
  if(pass!=="ELPAPUESPRO"){ alert("Contrase√±a incorrecta"); return; }
  const name=document.getElementById('playerName').value.trim();
  const time=parseFloat(document.getElementById('playerTime').value);
  const video=document.getElementById('playerVideo').value.trim();
  const category=document.getElementById('runCategory').value;
  if(!name||isNaN(time)){ alert("Completa todos los campos"); return; }
  const table=document.getElementById(category);
  const row=document.createElement('tr');
  row.innerHTML=`<td></td><td>${name}</td><td>${time.toFixed(2)}</td><td>Custom</td><td>${video? `<a href="${video}" target="_blank">VER</a>`:'--'}</td>`;
  table.appendChild(row);
  sortTable(table);
  saveRuns();
  checkLogros(time,category);
  document.getElementById('playerName').value="";
  document.getElementById('playerTime').value="";
  document.getElementById('playerVideo').value="";
  document.getElementById('importPass').value="";
  importPanel.style.display="none";
}
function checkLogros(time,category){
  unlock('primerRun'); if(time<30) unlock('sub30'); if(time<20) unlock('sub20'); if(time<19) unlock('sub19');
  const totalRuns=[...document.querySelectorAll("table")].reduce((acc,t)=>acc+t.rows.length-1,0);
  if(totalRuns>=10) unlock('grinder');
  saveLogros();
}
function unlock(id){ if(!LOGROS[id].unlocked){ LOGROS[id].unlocked=true; alert("üèÜ LOGRO DESBLOQUEADO: "+LOGROS[id].nombre); } }

/* -------------------- BORRAR SPEEDRUN -------------------- */
function showDeletePanel(){
  const visibleTable=[...document.querySelectorAll("table")].find(t=>t.style.display==="table");
  if(!visibleTable || visibleTable.rows.length<=1){ alert("No hay runs visibles para borrar"); return; }
  const rows=[...visibleTable.rows].slice(1);
  const list=rows.map((r,i)=>`${i+1}: ${r.cells[1].innerText} - ${r.cells[2].innerText}`).join("\n");
  const sel=parseInt(prompt("Selecciona el n√∫mero del run a borrar:\n"+list))-1;
  if(isNaN(sel)||sel<0||sel>=rows.length){ alert("Selecci√≥n inv√°lida"); return; }
  const pass=prompt("Introduce contrase√±a para borrar:");
  if(pass!=="ELPAPUESPRO"){ alert("Contrase√±a incorrecta"); return; }
  if(confirm("REALMENTE QUIERES BORRAR ESTE RUN?")){ rows[sel].remove(); saveRuns(); alert("Run borrado exitosamente"); }
}

/* -------------------- ORDENAR -------------------- */
function sortTable(table){
  const rows=[...table.rows].slice(1);
  rows.sort((a,b)=>parseFloat(a.cells[2].innerText)-parseFloat(b.cells[2].innerText));
  rows.forEach((r,i)=>{
    r.classList.remove("top1","top2","top3");
    if(i===0) r.classList.add("top1");
    if(i===1) r.classList.add("top2");
    if(i===2) r.classList.add("top3");
    r.cells[0].innerText=i+1;
    table.appendChild(r);
  });
}

/* -------------------- LOGROS -------------------- */
function loadLogros(){
  const saved=JSON.parse(localStorage.getItem("papuLogros"));
  if(saved) for(const k in LOGROS) if(saved[k]!==undefined) LOGROS[k].unlocked=saved[k];
}
function saveLogros(){
  const data={}; for(const k in LOGROS) data[k]=LOGROS[k].unlocked;
  localStorage.setItem("papuLogros",JSON.stringify(data));
}
function showLogros(){
  hideAll(); menuPanel.style.display= "none"; 
  const container = document.getElementById("logrosList");
  container.innerHTML = "";
  for(const id in LOGROS){
    const btn = document.createElement("button");
    btn.style.width="90%";
    btn.style.margin="8px 0";
    btn.style.padding="12px";
    btn.style.fontFamily="'Press Start 2P'";
    btn.style.fontSize="14px";
    btn.style.cursor="pointer";
    btn.style.border="3px solid white";
    btn.style.background="black";
    btn.style.color="white";
    btn.innerText = LOGROS[id].unlocked ? LOGROS[id].nombre : "-----------";
    btn.onclick = ()=>showLogroInfo(id);
    container.appendChild(btn);
  }
}

function showLogroInfo(id){
  hideAll();
  document.getElementById("logroInfoPanel").style.display="block";
  document.getElementById("infoTitle").innerText = LOGROS[id].nombre;
  const infoText = {
    primerRun: "Realiza tu primer run y autom√°ticamente desbloqueas este logro.",
    sub30: "Completa cualquier run en menos de 30 segundos.",
    sub20: "Completa cualquier run en menos de 20 segundos.",
    sub19: "Completa cualquier run en menos de 19 segundos.",
    grinder: "Acumula 10 o m√°s runs en las tablas para desbloquear este logro.",
    secreto: "??? Secreto que debes descubrir t√∫ mismo...",
    pacfan: "Realiza alguna haza√±a especial relacionada con Pacman."
  };
  document.getElementById("infoDesc").innerText = infoText[id] || "Informaci√≥n no disponible.";
}

/* -------------------- M√öSICA -------------------- */
function onYouTubeIframeAPIReady(){
  ytPlayer=new YT.Player('ytPlayer',{
    events:{
      'onReady':()=>{
        ytPlayer.playVideo();
      },
      'onStateChange':(e)=>{
        if(e.data===YT.PlayerState.ENDED){ nextSong(); }
      }
    }
  });
}
function toggleMusic(){
  if(!ytPlayer) return;
  if(musicOn){ ytPlayer.pauseVideo(); musicOn=false; stopActive=true; }
  else{ ytPlayer.playVideo(); musicOn=true; stopActive=false; }
}
function toggleStop(){ if(!ytPlayer) return; if(!stopActive){ ytPlayer.pauseVideo(); stopActive=true; } else{ ytPlayer.playVideo(); stopActive=false; } }
function nextSong(){ playlistIndex=(playlistIndex+1)%playlistIds.length; ytPlayer.loadVideoById(playlistIds[playlistIndex]); }
function prevSong(){ playlistIndex=(playlistIndex-1+playlistIds.length)%playlistIds.length; ytPlayer.loadVideoById(playlistIds[playlistIndex]); }

/* -------------------- INICIALIZACI√ìN -------------------- */
window.onload = ()=>{
  loadRuns();
  loadLogros();
  showCategory('lvl11');
  showLogros();
}
</script>

<script src="https://www.youtube.com/iframe_api"></script>

</body>
</html>
