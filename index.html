<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PAPU Speedruns</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  font-family:'Press Start 2P', monospace;
  color:white;
  background:
    repeating-linear-gradient(
      45deg,
      #0b0b0b 0px,
      #0b0b0b 4px,
      #000 4px,
      #000 8px
    );
  animation:bgMove 30s linear infinite;
}

@keyframes bgMove{
  from{background-position:0 0}
  to{background-position:400px 400px}
}

/* MENÚ */
.menu{
  position:fixed;
  top:15px;
  right:20px;
  font-size:42px;
  cursor:pointer;
}

.menu-panel{
  display:none;
  position:fixed;
  top:80px;
  right:20px;
  width:280px;
  background:#111;
  border:4px solid white;
  padding:15px;
  animation:slide .25s ease;
}

@keyframes slide{
  from{opacity:0; transform:translateY(-10px)}
  to{opacity:1; transform:none}
}

.menu-panel button{
  width:100%;
  margin:6px 0;
  padding:10px;
  font-family:'Press Start 2P';
  background:black;
  color:white;
  border:3px solid white;
}

/* TITULO */
.title{
  text-align:center;
  margin-top:120px;
  font-size:48px;
}
.subtitle{
  text-align:center;
  margin:20px 0;
}

/* CATEGORÍA */
#currentCategory{
  text-align:center;
  font-size:20px;
  color:#00ff00;
  margin-bottom:10px;
}

#catBtn{
  display:block;
  margin:0 auto 15px;
  padding:14px;
  width:70%;
  font-family:'Press Start 2P';
  background:black;
  color:red;
  border:4px solid white;
}

.category-panel{
  display:none;
  width:300px;
  margin:0 auto;
  background:#111;
  border:4px solid white;
  padding:15px;
}
.category-panel button{
  width:100%;
  margin:6px 0;
  padding:10px;
  font-family:'Press Start 2P';
  background:black;
  color:white;
  border:3px solid white;
}

/* TABLAS */
table{
  width:95%;
  margin:25px auto;
  border-collapse:collapse;
  display:none;
}
th,td{
  border:3px solid white;
  padding:8px;
  text-align:center;
}
th{background:#222}

.top1{color:gold}
.top2{color:silver}
.top3{color:#cd7f32}

/* PANEL IMPORTAR */
.panel{
  display:none;
  width:80%;
  margin:40px auto;
  background:#111;
  border:4px solid white;
  padding:20px;
}
.panel input, .panel select{
  width:90%;
  margin:8px 0;
  padding:8px;
  font-family:'Press Start 2P';
}
.panel button{
  padding:10px;
  font-family:'Press Start 2P';
  border:3px solid white;
  background:black;
  color:white;
}

/* PLAYER */
#player{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#111;
  border:4px solid white;
  padding:10px;
  width:220px;
  text-align:center;
}
#player button{
  width:30%;
  font-family:'Press Start 2P';
}
</style>
</head>

<body>

<div class="menu" onclick="toggleMenu()">☰</div>

<div class="menu-panel" id="menu">
  <button onclick="showImport()">Importar Speedrun</button>
  <button onclick="deleteRun()">Borrar último</button>
</div>

<div class="title">EL PAPU<br>SPEEDRUNS</div>
<div class="subtitle">Clasificación</div>

<div id="currentCategory"></div>

<button id="catBtn" onclick="toggleCats()">Categorías</button>

<div class="category-panel" id="cats">
  <button onclick="showCategory('lvl11')">1-1 Level</button>
  <button onclick="showCategory('any')">Any%</button>
  <button onclick="showCategory('moon11')">Moonwalk Jump Solo – 1-1</button>
  <button onclick="showCategory('moonAny')">Moonwalk Jump Solo – Any%</button>
</div>

<table id="lvl11"><tr><th>#</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th></tr></table>
<table id="any"><tr><th>#</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th></tr></table>
<table id="moon11"><tr><th>#</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th></tr></table>
<table id="moonAny"><tr><th>#</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th></tr></table>

<div class="panel" id="importPanel">
  <h3>Importar Speedrun</h3>
  <input id="pass" type="password" placeholder="Contraseña">
  <input id="name" placeholder="Jugador">
  <input id="time" type="number" placeholder="Tiempo">
  <input id="platform" placeholder="Emulador / Consola (opcional)">
  <select id="cat">
    <option value="lvl11">1-1 Level</option>
    <option value="any">Any%</option>
    <option value="moon11">Moonwalk Jump Solo – 1-1</option>
    <option value="moonAny">Moonwalk Jump Solo – Any%</option>
  </select><br><br>
  <button onclick="addRun()">Agregar</button>
</div>

<!-- MÚSICA -->
<div id="player">
  <div>Música</div>
  <button onclick="prev()">◀</button>
  <button onclick="toggleMusic()">⏯</button>
  <button onclick="next()">▶</button>
</div>

<audio id="audio" loop></audio>

<script>
const names={
  lvl11:"1-1 Level",
  any:"Any%",
  moon11:"Moonwalk Jump Solo – 1-1",
  moonAny:"Moonwalk Jump Solo – Any%"
};

const songs=[
  "music1.mp3",
  "music2.mp3"
];
let songIndex=0, playing=false;

function toggleMenu(){
  menu.style.display=menu.style.display==="block"?"none":"block";
}
function toggleCats(){
  cats.style.display=cats.style.display==="block"?"none":"block";
}
function showCategory(id){
  document.querySelectorAll("table").forEach(t=>t.style.display="none");
  document.getElementById(id).style.display="table";
  currentCategory.innerText=names[id];
  cats.style.display="none";
}

function showImport(){
  importPanel.style.display="block";
  menu.style.display="none";
}

function addRun(){
  if(pass.value!=="ELPAPUESPRO") return alert("Contraseña incorrecta");
  const t=document.getElementById(cat.value);
  const r=t.insertRow();
  r.innerHTML=`<td></td><td>${name.value}</td><td>${time.value}</td><td>${platform.value||"--"}</td>`;
  sortTable(t);
  save();
  importPanel.style.display="none";
  name.value=time.value=platform.value=pass.value="";
}

function sortTable(t){
  const rows=[...t.rows].slice(1);
  rows.sort((a,b)=>a.cells[2].innerText-b.cells[2].innerText);
  rows.forEach((r,i)=>{
    r.cells[0].innerText=i+1;
    r.className=i==0?"top1":i==1?"top2":i==2?"top3":"";
    t.appendChild(r);
  });
}

function save(){
  const data={};
  document.querySelectorAll("table").forEach(t=>{
    data[t.id]=[...t.rows].slice(1).map(r=>({
      n:r.cells[1].innerText,
      t:r.cells[2].innerText,
      p:r.cells[3].innerText
    }));
  });
  localStorage.setItem("runs",JSON.stringify(data));
}

function load(){
  const d=JSON.parse(localStorage.getItem("runs")||"{}");
  for(let k in d){
    const t=document.getElementById(k);
    d[k].forEach(o=>{
      const r=t.insertRow();
      r.innerHTML=`<td></td><td>${o.n}</td><td>${o.t}</td><td>${o.p}</td>`;
    });
    sortTable(t);
  }
}

function deleteRun(){
  const t=[...document.querySelectorAll("table")].find(x=>x.style.display==="table");
  if(!t||t.rows.length<=1) return;
  if(prompt("Contraseña")!=="ELPAPUESPRO") return;
  t.deleteRow(t.rows.length-1);
  save();
}

/* MÚSICA */
const audio=document.getElementById("audio");
audio.src=songs[0];

function toggleMusic(){
  if(!playing){audio.play(); playing=true;}
  else{audio.pause(); playing=false;}
}
function next(){
  songIndex=(songIndex+1)%songs.length;
  audio.src=songs[songIndex];
  audio.play(); playing=true;
}
function prev(){
  songIndex=(songIndex-1+songs.length)%songs.length;
  audio.src=songs[songIndex];
  audio.play(); playing=true;
}

window.onload=()=>{
  load();
  showCategory("lvl11");
};
</script>

</body>
</html>
