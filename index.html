<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PAPU Speedruns</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body {
  background:black;
  color:white;
  margin:0;
  font-family:'Press Start 2P', monospace;
  overflow-x:hidden;
}

/* FONDO ANIMADO NES */
body::before{
  content:"";
  position:fixed;
  top:0; left:0;
  width:200%; height:200%;
  background-image:repeating-linear-gradient(45deg,#222 0 1px,#111 1px 2px);
  z-index:-1;
  animation:bgMove 20s linear infinite;
}
@keyframes bgMove{
  0%{transform:translate(0,0);}
  50%{transform:translate(-50px,50px);}
  100%{transform:translate(0,0);}
}

/* MENÚ */
.menu{
  position:fixed;
  top:20px; right:30px;
  font-size:48px;
  cursor:pointer;
  z-index:100;
}
.menu-panel{
  display:none;
  position:fixed;
  top:90px; right:30px;
  background:#111;
  border:4px solid white;
  padding:20px;
  width:320px;
  z-index:100;
}
.menu-panel button{
  width:100%;
  margin-bottom:12px;
  padding:14px;
  font-family:'Press Start 2P';
  font-size:14px;
  background:black;
  color:white;
  border:3px solid white;
  cursor:pointer;
  transition:transform 0.15s, box-shadow 0.15s;
}
.menu-panel button:hover{
  transform:scale(1.05) rotate(-1deg);
  box-shadow:0 0 12px white;
}

/* CATEGORÍA ACTUAL */
#currentCategory{
  text-align:center;
  font-size:28px;
  margin-top:10px;
  color:#00ff00;
}

/* TITULO */
.title-wrapper{
  text-align:center;
  margin-top:15vh;
  font-size:64px;
}
.title-line{
  display:block;
  animation:slideDown 1s ease forwards;
}
@keyframes slideDown{
  0%{transform:translateY(-100px); opacity:0;}
  100%{transform:translateY(0); opacity:1;}
}
.subtitle{
  text-align:center;
  margin-top:20px;
  font-size:24px;
}

/* BOTON CATEGORIAS */
#categoryMainBtn{
  display:block;
  margin:20px auto 30px auto;
  background:black;
  border:4px solid white;
  color:red;
  font-family:'Press Start 2P';
  font-size:24px;
  padding:20px;
  width:70%;
  text-align:center;
  cursor:pointer;
  transition:transform 0.15s, box-shadow 0.15s;
}
#categoryMainBtn:hover{
  transform:scale(1.05) rotate(1deg);
  box-shadow:0 0 12px white;
}

/* CATEGORY PANEL */
.category-panel{
  display:none;
  margin:0 auto 30px auto;
  text-align:center;
  background:#111;
  border:4px solid white;
  padding:20px;
  width:300px;
}
.category-panel button{
  width:90%;
  margin:10px 0;
  padding:14px;
  font-family:'Press Start 2P';
  font-size:16px;
  background:black;
  color:white;
  border:3px solid white;
  cursor:pointer;
  transition:transform 0.15s;
}
.category-panel button:hover{
  transform:scale(1.1) rotate(1deg);
  box-shadow:0 0 10px white;
}

/* TABLAS */
table{
  width:95%;
  margin:20px auto 50px auto;
  border-collapse:collapse;
  font-size:16px;
  display:none;
}
th,td{
  border:3px solid white;
  padding:12px;
  text-align:center;
  position:relative;
}
th{background:#222;}
a{color:#00ffcc;text-decoration:none;}

/* INFO PANELS */
.info-panel{
  display:none;
  margin:60px auto;
  background:#111;
  border:4px solid white;
  padding:30px;
  width:80%;
  text-align:center;
  position:relative;
}
.close-btn{
  position:absolute;
  top:12px;
  right:16px;
  font-size:24px;
  cursor:pointer;
}
.close-btn:hover{color:red;}

/* BOTONES LOGROS */
#logrosList button{
  width:80%;
  margin:8px 0;
  padding:12px;
  background:#222;
  color:white;
  border:3px solid white;
  cursor:pointer;
  font-family:'Press Start 2P';
}
#logrosList button:hover{
  transform:scale(1.05);
  box-shadow:0 0 8px white;
}

/* MINI PLAYER */
#miniPlayer{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#111;
  border:4px solid white;
  width:220px;
  height:220px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
  z-index:1000;
  padding:10px;
}
#miniPlayer #currentSong{
  color:#00ff00;
  font-family:'Press Start 2P';
  font-size:18px;
  text-align:center;
}
#miniPlayer .buttonsRow{
  display:flex;
  justify-content:space-around;
  width:100%;
}
#miniPlayer .buttonsRow button{
  background:black;
  color:white;
  border:3px solid white;
  font-family:'Press Start 2P';
  font-size:18px;
  cursor:pointer;
  padding:10px 14px;
  width:30%;
  transition:0.2s;
}
#miniPlayer .buttonsRow button:hover{
  transform:scale(1.1);
  box-shadow:0 0 10px white;
}

/* RESALTAR 1°,2°,3° */
.top1{animation:glowGold 1s infinite alternate;}
.top2{animation:glowSilver 1s infinite alternate;}
.top3{animation:glowBronze 1s infinite alternate;}
@keyframes glowGold{0%{text-shadow:0 0 5px #FFD700;}100%{text-shadow:0 0 20px #FFD700;}}
@keyframes glowSilver{0%{text-shadow:0 0 5px #C0C0C0;}100%{text-shadow:0 0 20px #C0C0C0;}}
@keyframes glowBronze{0%{text-shadow:0 0 5px #CD7F32;}100%{text-shadow:0 0 20px #CD7F32;}}
</style>
</head>
<body>

<div class="menu" onclick="toggleMenu()">☰</div>
<div class="menu-panel" id="menuPanel">
  <button onclick="showImport()">Importar Speedrun</button>
  <button onclick="showDeletePanel()">Borrar Speedrun</button>
  <button onclick="showLogros()">Logros</button>
</div>

<div id="currentCategory"></div>

<div class="title-wrapper">
  <span class="title-line">EL PAPU</span>
  <span class="title-line">SPEEDRUNS</span>
</div>
<div class="subtitle">Clasificación</div>
<button id="categoryMainBtn" onclick="toggleBigCategory()">Categorías</button>
<div class="category-panel" id="bigCategory">
  <button onclick="firstCategory('lvl11')">1-1 Level</button>
  <button onclick="firstCategory('any')">Any%</button>
  <button onclick="firstCategory('warpless')">Warpless</button>
  <button onclick="firstCategory('moon11')">Moonwalk Jump Solo - 1-1</button>
  <button onclick="firstCategory('moonAny')">Moonwalk Jump Solo - Any%</button>
</div>

<!-- TABLAS -->
<table id="lvl11"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="any"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="warpless"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="moon11"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="moonAny"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>

<!-- IMPORTAR SPEEDRUN -->
<div class="info-panel" id="importPanel">
  <span class="close-btn" onclick="closePanels()">✕</span>
  <h3>Importar Speedrun</h3>
  <input type="password" id="importPass" placeholder="Contraseña"><br><br>
  <input type="text" id="playerName" placeholder="Nombre jugador">
  <input type="number" id="playerTime" placeholder="Tiempo">
  <input type="text" id="playerVideo" placeholder="URL único del video">
  <select id="runCategory">
    <option value="lvl11">1-1 Level</option>
    <option value="any">Any%</option>
    <option value="warpless">Warpless</option>
    <option value="moon11">Moonwalk Jump Solo - 1-1</option>
    <option value="moonAny">Moonwalk Jump Solo - Any%</option>
  </select><br><br>
  <button onclick="addSpeedrun()">Agregar Speedrun</button>
</div>

<!-- LOGROS -->
<div class="info-panel" id="logrosPanel">
  <span class="close-btn" onclick="closePanels()">✕</span>
  <h3>Logros</h3>
  <div id="logrosList"></div>
</div>
<div class="info-panel" id="logroInfoPanel">
  <span class="close-btn" onclick="closePanels()">✕</span>
  <h3 id="infoTitle">Título</h3>
  <p id="infoDesc">Descripción</p>
</div>

<!-- MINI PLAYER -->
<div id="miniPlayer">
  <div id="currentSong"></div>
  <div class="buttonsRow">
    <button onclick="prevSong()">◀</button>
    <button onclick="toggleStop()">⏹</button>
    <button onclick="nextSong()">▶</button>
  </div>
</div>

<iframe id="ytPlayer" width="0" height="0" src="https://www.youtube.com/embed/NTa6Xbzfq1U?enablejsapi=1" frameborder="0" allow="autoplay" allowfullscreen></iframe>

<script>
/* -------------------- VARIABLES -------------------- */
let ytPlayer, musicOn=true, stopActive=false;
let playlistIndex=2; // empieza 3ra canción
const playlistIds=['NTa6Xbzfq1U','7tTVYfgDf6g','Rrx0F1TzQ0M','7hG-96NiMXU','3GqWF2a-fo8'];
const currentSongDiv=document.getElementById("currentSong");
const currentCategoryDiv=document.getElementById("currentCategory");
const menuPanel=document.getElementById("menuPanel");
const bigCategory=document.getElementById("bigCategory");

/* -------------------- LOGROS -------------------- */
const LOGROS={
  primerRun:{nombre:"Primer Run",unlocked:false,desc:"Haz tu primer run en cualquier categoría."},
  sub30:{nombre:"Sub 30",unlocked:false,desc:"Completa un run en menos de 30 segundos."},
  sub20:{nombre:"Sub 20",unlocked:false,desc:"Completa un run en menos de 20 segundos."},
  sub19:{nombre:"Sub 19",unlocked:false,desc:"Completa un run en menos de 19 segundos."},
  grinder:{nombre:"Lento Tortuga",unlocked:false,desc:"Juega varias veces para desbloquear este logro."}
};

/* -------------------- PLAYER -------------------- */
function onYouTubeIframeAPIReady(){
  ytPlayer=new YT.Player('ytPlayer',{
    events:{
      'onReady':()=>{
        ytPlayer.loadVideoById(playlistIds[playlistIndex]);
        ytPlayer.playVideo();
        setTimeout(updateCurrentSong,1000);
        setInterval(updateCurrentSong,2000);
      },
      'onStateChange':(e)=>{ if(e.data===YT.PlayerState.ENDED) nextSong(); }
    }
  });
}
function updateCurrentSong(){
  if(!ytPlayer||!ytPlayer.getVideoData) return;
  const data=ytPlayer.getVideoData();
  if(data.title) currentSongDiv.innerText=data.title;
}
function toggleMusic(){if(!ytPlayer)return; musicOn?ytPlayer.pauseVideo(),musicOn=false,stopActive=true:ytPlayer.playVideo(),musicOn=true,stopActive=false,updateCurrentSong();}
function toggleStop(){if(!ytPlayer)return;!stopActive?ytPlayer.pauseVideo(),stopActive=true:ytPlayer.playVideo(),stopActive=false,updateCurrentSong();}
function nextSong(){playlistIndex=(playlistIndex+1)%playlistIds.length;ytPlayer.loadVideoById(playlistIds[playlistIndex]);ytPlayer.playVideo();updateCurrentSong();}
function prevSong(){playlistIndex=(playlistIndex-1+playlistIds.length)%playlistIds.length;ytPlayer.loadVideoById(playlistIds[playlistIndex]);ytPlayer.playVideo();updateCurrentSong();}

/* -------------------- MENÚ Y CATEGORIAS -------------------- */
function toggleMenu(){menuPanel.style.display=menuPanel.style.display==="block"?"none":"block";}
function toggleBigCategory(){bigCategory.style.display=bigCategory.style.display==="block"?"none":"block";}
function firstCategory(id){bigCategory.style.display="none"; showCategory(id);}
function showCategory(id){hideAll(); const tbl=document.getElementById(id); tbl.style.display="table"; sortTable(tbl); menuPanel.style.display="none"; const names={ lvl11:"1-1 Level", any:"Any%", warpless:"Warpless", moon11:"Moonwalk Jump Solo - 1-1", moonAny:"Moonwalk Jump Solo - Any%" }; currentCategoryDiv.innerText=names[id]||"";}
function hideAll(){[...document.querySelectorAll("table")].forEach(t=>t.style.display="none"); [...document.querySelectorAll(".info-panel")].forEach(p=>p.style.display="none");}

/* -------------------- SPEEDRUNS -------------------- */
function loadRuns(){const saved=JSON.parse(localStorage.getItem('papuSpeedruns')||'{}'); for(const cat in saved){const table=document.getElementById(cat); saved[cat].forEach(run=>{const row=document.createElement('tr'); row.innerHTML=`<td></td><td>${run.name}</td><td>${run.time.toFixed(2)}</td><td>${run.platform}</td><td>${run.video?`<a href="${run.video}" target="_blank">VER</a>`:'--'}</td>`; table.appendChild(row);}); sortTable(table);}}
function saveRuns(){const data={}; [...document.querySelectorAll("table")].forEach(table=>{data[table.id]=[...table.rows].slice(1).map(r=>({name:r.cells[1].innerText,time:parseFloat(r.cells[2].innerText),platform:r.cells[3].innerText,video:r.cells[4].querySelector('a')?r.cells[4].querySelector('a').href:''}));}); localStorage.setItem('papuSpeedruns',JSON.stringify(data));}

/* -------------------- IMPORTAR -------------------- */
function addSpeedrun(){
  const pass=document.getElementById('importPass').value;
  if(pass!=="ELPAPUESPRO"){alert("Contraseña incorrecta"); return;}
  const name=document.getElementById('playerName').value.trim();
  const time=parseFloat(document.getElementById('playerTime').value);
  const video=document.getElementById('playerVideo').value.trim();
  const category=document.getElementById('runCategory').value;
  if(!name||isNaN(time)||!video){alert("Completa todos los campos y añade un video único"); return;}
  const allVideos=[...document.querySelectorAll("table")].flatMap(t=>[...t.rows].slice(1).map(r=>r.cells[4].querySelector('a')?.href)).filter(Boolean);
  if(allVideos.includes(video)){alert("Esta URL ya ha sido agregada"); return;}
  const table=document.getElementById(category);
  const row=document.createElement('tr');
  row.innerHTML=`<td></td><td>${name}</td><td>${time.toFixed(2)}</td><td>Custom</td><td><a href="${video}" target="_blank">VER</a></td>`;
  table.appendChild(row);
  sortTable(table);
  saveRuns();
  checkLogros(time,category);
  document.getElementById('playerName').value="";
  document.getElementById('playerTime').value="";
  document.getElementById('playerVideo').value="";
  document.getElementById('importPass').value="";
  document.getElementById('importPanel').style.display="none";
}

/* -------------------- BORRAR SPEEDRUN -------------------- */
function showDeletePanel(){
  const visibleTable=[...document.querySelectorAll("table")].find(t=>t.style.display==="table");
  if(!visibleTable || visibleTable.rows.length<=1){ alert("No hay runs visibles para borrar"); return; }
  const rows=[...visibleTable.rows].slice(1);
  const list=rows.map((r,i)=>`${i+1}: ${r.cells[1].innerText} - ${r.cells[2].innerText}`).join("\n");
  const sel=prompt("Selecciona el número del run a borrar:\n"+list);
  const index=parseInt(sel)-1;
  if(isNaN(index)||index<0||index>=rows.length){alert("Selección inválida"); return;}
  const pass=prompt("Introduce contraseña para borrar:");
  if(pass!=="ELPAPUESPRO"){alert("Contraseña incorrecta"); return;}
  if(confirm("¿REALMENTE QUIERES BORRAR ESTE RUN?")){rows[index].remove(); saveRuns(); alert("Run borrado exitosamente");}
}

/* -------------------- ORDENAR TABLA -------------------- */
function sortTable(table){
  const rows=[...table.rows].slice(1);
  rows.sort((a,b)=>parseFloat(a.cells[2].innerText)-parseFloat(b.cells[2].innerText));
  rows.forEach((r,i)=>{
    r.classList.remove("top1","top2","top3");
    if(i===0) r.classList.add("top1");
    if(i===1) r.classList.add("top2");
    if(i===2) r.classList.add("top3");
    r.cells[0].innerText=i+1;
    table.appendChild(r);
  });
}

/* -------------------- LOGROS -------------------- */
function loadLogros(){
  const unlocked=JSON.parse(localStorage.getItem('papuLogros')||'{}');
  for(const key in unlocked) if(LOGROS[key]) LOGROS[key].unlocked=unlocked[key];
}
function saveLogros(){ 
  localStorage.setItem('papuLogros', JSON.stringify(Object.fromEntries(Object.entries(LOGROS).map(([k,v])=>[k,v.unlocked])))); 
}
function checkLogros(time, category){
  if(!LOGROS.primerRun.unlocked) LOGROS.primerRun.unlocked=true;
  if(time<30) LOGROS.sub30.unlocked=true;
  if(time<20) LOGROS.sub20.unlocked=true;
  if(time<19) LOGROS.sub19.unlocked=true;
  LOGROS.grinder.unlocked=true;
  saveLogros();
}

/* -------------------- PANEL LOGROS -------------------- */
function showLogros(){
  hideAll(); menuPanel.style.display="none";
  const list=document.getElementById("logrosList"); list.innerHTML="";
  for(const key in LOGROS){
    const btn=document.createElement("button");
    btn.innerText=LOGROS[key].unlocked?LOGROS[key].nombre:"-----------";
    btn.onclick=()=>showLogroInfo(key);
    list.appendChild(btn);
  }
  document.getElementById("logrosPanel").style.display="block";
}
function showLogroInfo(key){
  const infoPanel=document.getElementById("logroInfoPanel");
  document.getElementById("infoTitle").innerText=LOGROS[key].nombre;
  document.getElementById("infoDesc").innerText=LOGROS[key].desc || "Sin descripción disponible";
  infoPanel.style.display="block";
}

/* -------------------- PANEL IMPORTAR -------------------- */
function showImport(){ hideAll(); menuPanel.style.display="none"; document.getElementById("importPanel").style.display="block"; }

/* -------------------- OTROS -------------------- */
function closePanels(){ [...document.querySelectorAll(".info-panel")].forEach(p=>p.style.display="none"); }

/* -------------------- INICIALIZACION -------------------- */
window.onload=()=>{
  loadRuns();
  loadLogros();
  showCategory('lvl11');
  if(typeof YT==='undefined'){
    const tag=document.createElement('script');
    tag.src="https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);
  } else { onYouTubeIframeAPIReady(); }
};
</script>
</body>
</html>
