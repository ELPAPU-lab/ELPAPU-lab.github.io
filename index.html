<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PAPU Speedruns</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:'Press Start 2P', monospace;
  overflow-x:hidden;
}

/* Fondo NES */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    45deg,#111 0 2px,#000 2px 4px
  );
  z-index:-1;
  animation:bg 20s linear infinite;
}
@keyframes bg{
  from{transform:translate(0,0)}
  to{transform:translate(-200px,200px)}
}

/* MEN√ö */
.menu{
  position:fixed;
  top:20px;
  right:20px;
  font-size:48px;
  cursor:pointer;
  z-index:10;
}

.menu-panel{
  position:fixed;
  top:90px;
  right:20px;
  width:300px;
  background:#111;
  border:4px solid white;
  padding:20px;
  display:none;
  animation:slideMenu .3s ease;
}
@keyframes slideMenu{
  from{transform:translateY(-20px);opacity:0}
  to{transform:translateY(0);opacity:1}
}

.menu-panel button{
  width:100%;
  margin:8px 0;
  padding:12px;
  font-family:'Press Start 2P';
  background:black;
  color:white;
  border:3px solid white;
  cursor:pointer;
}

/* T√çTULO */
.title{
  text-align:center;
  margin-top:15vh;
  font-size:56px;
}
.subtitle{
  text-align:center;
  margin:20px 0;
  font-size:20px;
}

/* CATEGOR√çAS */
#currentCategory{
  text-align:center;
  color:#00ff00;
  font-size:22px;
  margin-bottom:10px;
}

#catBtn{
  display:block;
  margin:0 auto 20px;
  padding:16px;
  width:70%;
  font-family:'Press Start 2P';
  background:black;
  color:red;
  border:4px solid white;
  cursor:pointer;
}

.category-panel{
  display:none;
  width:300px;
  margin:0 auto;
  background:#111;
  border:4px solid white;
  padding:20px;
}
.category-panel button{
  width:100%;
  margin:6px 0;
  padding:12px;
  font-family:'Press Start 2P';
  background:black;
  color:white;
  border:3px solid white;
}

/* TABLAS */
table{
  width:95%;
  margin:30px auto;
  border-collapse:collapse;
  display:none;
}
th,td{
  border:3px solid white;
  padding:10px;
  text-align:center;
}
th{background:#222}

/* TOP */
.top1{color:gold}
.top2{color:silver}
.top3{color:#cd7f32}

/* PANELES */
.panel{
  display:none;
  width:80%;
  margin:40px auto;
  background:#111;
  border:4px solid white;
  padding:20px;
}
.panel input, .panel select{
  width:80%;
  margin:8px 0;
  padding:10px;
  font-family:'Press Start 2P';
}
.panel button{
  padding:12px;
  font-family:'Press Start 2P';
  border:3px solid white;
  background:black;
  color:white;
}

/* MINI PLAYER */
#player{
  position:fixed;
  bottom:20px;
  right:20px;
  width:220px;
  background:#111;
  border:4px solid white;
  padding:10px;
  text-align:center;
}
#player button{
  width:30%;
  font-family:'Press Start 2P';
}

/* LOGROS */
#achievement{
  position:fixed;
  top:30px;
  left:50%;
  transform:translateX(-50%);
  background:#111;
  border:4px solid #00ff00;
  color:#00ff00;
  padding:20px;
  display:none;
  z-index:20;
}
</style>
</head>

<body>

<div class="menu" onclick="toggleMenu()">‚ò∞</div>

<div class="menu-panel" id="menu">
  <button onclick="showImport()">Importar Speedrun</button>
  <button onclick="deleteRun()">Borrar Speedrun</button>
  <button onclick="toggleMusic()">M√∫sica ON / OFF</button>
</div>

<div id="achievement"></div>

<div class="title">EL PAPU<br>SPEEDRUNS</div>
<div class="subtitle">Clasificaci√≥n</div>

<div id="currentCategory"></div>

<button id="catBtn" onclick="toggleCats()">Categor√≠as</button>

<div class="category-panel" id="cats">
  <button onclick="showCategory('lvl11')">1-1 Level</button>
  <button onclick="showCategory('any')">Any%</button>
  <button onclick="showCategory('moon11')">Moonwalk Jump Solo - 1-1</button>
  <button onclick="showCategory('moonAny')">Moonwalk Jump Solo - Any%</button>
</div>

<table id="lvl11"><tr><th>#</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th></tr></table>
<table id="any"><tr><th>#</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th></tr></table>
<table id="moon11"><tr><th>#</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th></tr></table>
<table id="moonAny"><tr><th>#</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th></tr></table>

<!-- IMPORTAR -->
<div class="panel" id="importPanel">
  <h3>Importar Speedrun</h3>
  <input type="password" id="pass" placeholder="Contrase√±a">
  <input id="name" placeholder="Jugador">
  <input id="time" type="number" placeholder="Tiempo">
  <input id="platform" placeholder="Emulador / Consola (opcional)">
  <select id="cat">
    <option value="lvl11">1-1 Level</option>
    <option value="any">Any%</option>
    <option value="moon11">Moonwalk Jump Solo - 1-1</option>
    <option value="moonAny">Moonwalk Jump Solo - Any%</option>
  </select>
  <br><br>
  <button onclick="addRun()">Agregar</button>
</div>

<!-- PLAYER -->
<div id="player">
  <div id="song">M√∫sica</div>
  <button onclick="prev()">‚óÄ</button>
  <button onclick="stop()">‚èπ</button>
  <button onclick="next()">‚ñ∂</button>
</div>

<iframe id="yt" width="0" height="0"
src="https://www.youtube.com/embed/NTa6Xbzfq1U?enablejsapi=1&autoplay=1"
allow="autoplay"></iframe>

<script>
let music=true, index=0;
const songs=['NTa6Xbzfq1U','osPq9Yb8xm8','3H220odl1D4'];
let yt;

function onYouTubeIframeAPIReady(){
 yt=new YT.Player('yt');
}

function toggleMenu(){
 document.getElementById('menu').style.display=
 document.getElementById('menu').style.display==='block'?'none':'block';
}

function toggleCats(){
 const c=document.getElementById('cats');
 c.style.display=c.style.display==='block'?'none':'block';
}

function showCategory(id){
 document.querySelectorAll('table').forEach(t=>t.style.display='none');
 document.getElementById(id).style.display='table';
 document.getElementById('currentCategory').innerText=id;
 toggleCats();
}

function showImport(){
 document.getElementById('importPanel').style.display='block';
 document.getElementById('menu').style.display='none';
}

function addRun(){
 if(document.getElementById('pass').value!=='ELPAPUESPRO'){alert('Clave mal');return;}
 const t=document.getElementById(document.getElementById('cat').value);
 const r=t.insertRow();
 r.innerHTML=`<td></td><td>${name.value}</td><td>${time.value}</td><td>${platform.value||'--'}</td>`;
 sort(t);
 save();
 achievement("Primer Speedrun agregado üèÜ");
}

function sort(t){
 const rows=[...t.rows].slice(1);
 rows.sort((a,b)=>a.cells[2].innerText-b.cells[2].innerText);
 rows.forEach((r,i)=>{
  r.cells[0].innerText=i+1;
  r.className=i==0?'top1':i==1?'top2':i==2?'top3':'';
  t.appendChild(r);
 });
}

function save(){
 const data={};
 document.querySelectorAll('table').forEach(t=>{
  data[t.id]=[...t.rows].slice(1).map(r=>({
   n:r.cells[1].innerText,
   t:r.cells[2].innerText,
   p:r.cells[3].innerText
  }));
 });
 localStorage.setItem('runs',JSON.stringify(data));
}

function load(){
 const d=JSON.parse(localStorage.getItem('runs')||'{}');
 for(let k in d){
  const t=document.getElementById(k);
  d[k].forEach(o=>{
   const r=t.insertRow();
   r.innerHTML=`<td></td><td>${o.n}</td><td>${o.t}</td><td>${o.p}</td>`;
  });
  sort(t);
 }
}

function deleteRun(){
 const t=[...document.querySelectorAll('table')].find(x=>x.style.display==='table');
 if(!t||t.rows.length<=1)return alert("Nada para borrar");
 if(prompt("Contrase√±a")!=="ELPAPUESPRO")return;
 t.deleteRow(t.rows.length-1);
 save();
}

function achievement(text){
 const a=document.getElementById('achievement');
 a.innerText=text;
 a.style.display='block';
 setTimeout(()=>a.style.display='none',3000);
}

function toggleMusic(){ music=!music; music?yt.playVideo():yt.pauseVideo();}
function next(){index=(index+1)%songs.length; yt.loadVideoById(songs[index]);}
function prev(){index=(index-1+songs.length)%songs.length; yt.loadVideoById(songs[index]);}
function stop(){yt.pauseVideo();}

window.onload=()=>{load(); showCategory('lvl11');}
</script>

<script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
