<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PAPU Speedruns</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body{
  background:black;
  color:white;
  margin:0;
  font-family:'Press Start 2P', monospace;
  overflow-x:hidden;
  position:relative;
}

/* ---------- MENU ---------- */
.menu{
  position:fixed;
  top:20px;
  right:30px;
  font-size:48px;
  cursor:pointer;
  z-index:100;
}
.menu-panel{
  display:none;
  position:fixed;
  top:90px;
  right:30px;
  background:#111;
  border:4px solid white;
  padding:20px;
  width:320px;
  z-index:100;
}
.menu-panel button{
  width:100%;
  margin-bottom:12px;
  padding:14px;
  font-family:'Press Start 2P';
  font-size:14px;
  background:black;
  color:white;
  border:3px solid white;
  cursor:pointer;
  transition:transform 0.15s, box-shadow 0.15s;
}
.menu-panel button:hover{
  transform:scale(1.05) rotate(-1deg);
  box-shadow:0 0 12px white;
}

/* ---------- TITULO ---------- */
.title-wrapper{
  text-align:center;
  margin-top:15vh;
  font-size:64px;
}
.title-line{
  display:block;
  animation:slideDown 1s ease forwards;
}
@keyframes slideDown{
  0%{transform:translateY(-100px); opacity:0;}
  100%{transform:translateY(0); opacity:1;}
}
.subtitle{
  text-align:center;
  margin-top:20px;
  font-size:24px;
}

/* ---------- BOTON CATEGORIAS ---------- */
#categoryMainBtn{
  display:block;
  margin:20px auto 30px auto;
  background:black;
  border:4px solid white;
  color:red;
  font-family:'Press Start 2P';
  font-size:24px;
  padding:20px;
  width:70%;
  text-align:center;
  cursor:pointer;
  transition:transform 0.15s, box-shadow 0.15s;
}
#categoryMainBtn:hover{
  transform:scale(1.05) rotate(1deg);
  box-shadow:0 0 12px white;
}

/* ---------- CATEGORY PANEL ---------- */
.category-panel{
  display:none;
  margin:0 auto 30px auto;
  text-align:center;
  background:#111;
  border:4px solid white;
  padding:20px;
  width:300px;
}
.category-panel button{
  width:90%;
  margin:10px 0;
  padding:14px;
  font-family:'Press Start 2P';
  font-size:16px;
  background:black;
  color:white;
  border:3px solid white;
  cursor:pointer;
  transition:transform 0.15s;
}
.category-panel button:hover{
  transform:scale(1.1) rotate(1deg);
  box-shadow:0 0 10px white;
}

/* ---------- TABLAS ---------- */
table{
  width:95%;
  margin:20px auto 50px auto;
  border-collapse:collapse;
  font-size:16px;
  display:none;
}
th,td{
  border:3px solid white;
  padding:12px;
  text-align:center;
}
th{background:#222;}
a{color:#00ffcc;text-decoration:none;}

/* ---------- INFO PANELS ---------- */
.info-panel{
  display:none;
  margin:60px auto;
  background:#111;
  border:4px solid white;
  padding:30px;
  width:80%;
  text-align:center;
  position:relative;
}
.close-btn{
  position:absolute;
  top:12px;
  right:16px;
  font-size:24px;
  cursor:pointer;
}
.close-btn:hover{color:red;}

/* ---------- MINI PLAYER ---------- */
#miniPlayer{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#111;
  border:4px solid white;
  width:220px;
  height:220px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
  z-index:1000;
  padding:10px;
}
#miniPlayer #currentSong,#trackCounter{
  color:#00ff00;
  font-family:'Press Start 2P';
  font-size:18px;
  text-align:center;
}
#miniPlayer .buttonsRow{
  display:flex;
  justify-content:space-around;
  width:100%;
}
#miniPlayer .buttonsRow button{
  background:black;
  color:white;
  border:3px solid white;
  font-family:'Press Start 2P';
  font-size:18px;
  cursor:pointer;
  padding:10px 14px;
  width:30%;
  transition:0.2s;
}
#miniPlayer .buttonsRow button:hover{
  transform:scale(1.1);
  box-shadow:0 0 10px white;
}

/* ---------- BORRAR RUN PANEL ---------- */
#deletePanel{
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  background:#111;
  border:4px solid white;
  padding:30px;
  width:400px;
  text-align:center;
  z-index:2000;
}
#deletePanel button{
  margin:10px;
  padding:12px 20px;
  font-family:'Press Start 2P';
  font-size:14px;
  cursor:pointer;
}
#deletePanel #yesDelete{background:green;color:white;}
#deletePanel #noDelete{background:red;color:white;}

/* ---------- MARIO ---------- */
#mario{
  position:fixed;
  bottom:0;
  left:0;
  width:64px;
  height:64px;
  z-index:900;
}
</style>
</head>
<body>

<div class="menu" onclick="toggleMenu()">☰</div>
<div class="menu-panel" id="menuPanel">
  <button id="menuCatBtn" class="on" onclick="toggleCategories()" style="display:none">Categorías</button>
  <button onclick="showImport()">Importar Speedruns</button>
  <button onclick="showDeletePanel()">Borrar Speedruns</button>
  <button onclick="showRules()">REGLAS</button>
  <button id="musicBtn" class="on" onclick="toggleMusic()">Música ON/OFF</button>
</div>

<div class="title-wrapper">
  <span class="title-line">EL PAPU</span>
  <span class="title-line">SPEEDRUNS</span>
</div>

<div class="subtitle">Clasificación</div>
<button id="categoryMainBtn" onclick="toggleBigCategory()">Categorías</button>

<div class="category-panel" id="bigCategory">
  <button onclick="firstCategory('lvl11')">1-1 Level</button>
  <button onclick="firstCategory('any')">Any%</button>
  <button onclick="firstCategory('warpless')">Warpless</button>
  <button onclick="firstCategory('moon11')">Moonwalk Jump Solo - 1-1</button>
  <button onclick="firstCategory('moonAny')">Moonwalk Jump Solo - Any%</button>
</div>

<table id="lvl11">
<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>
</table>

<table id="any">
<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>
</table>

<table id="warpless">
<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>
</table>

<table id="moon11">
<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>
</table>

<table id="moonAny">
<tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr>
</table>

<div class="info-panel" id="importPanel">
<span class="close-btn" onclick="closePanels()">✕</span>
<h3>Importar Speedrun</h3>
<input type="password" id="importPass" placeholder="Contraseña">
<br><br>
<input type="text" id="playerName" placeholder="Nombre jugador">
<input type="number" id="playerTime" placeholder="Tiempo">
<input type="text" id="playerVideo" placeholder="URL del video">
<select id="runCategory">
  <option value="lvl11">1-1 Level</option>
  <option value="any">Any%</option>
  <option value="warpless">Warpless</option>
  <option value="moon11">Moonwalk Jump Solo - 1-1</option>
  <option value="moonAny">Moonwalk Jump Solo - Any%</option>
</select>
<br><br>
<button onclick="addSpeedrun()">Agregar Speedrun</button>
</div>

<div class="info-panel" id="rulesPanel">
<span class="close-btn" onclick="closePanels()">✕</span>
1) Video completo<br><br>
2) Sin editar<br><br>
3) Inicio y final visibles
</div>

<div id="miniPlayer">
  <div id="currentSong">Nuts</div>
  <div class="buttonsRow">
    <button onclick="prevSong()">◀</button>
    <button onclick="toggleStop()">⏹</button>
    <button onclick="nextSong()">▶</button>
  </div>
  <div id="trackCounter">1 / 7</div>
</div>

<div id="deletePanel">
  <p>Para borrar, pon la contraseña:</p>
  <input type="password" id="deletePass">
  <br><br>
  <button onclick="confirmDelete()">Confirmar Contraseña</button>
  <div id="deleteConfirm" style="display:none;">
    <p>REALMENTE QUIERES BORRAR ESTE RUN?, NO PODRÁS RECUPERARLO JAMÁS BRO :V</p>
    <button id="yesDelete" onclick="deleteRun()">SI WE</button>
    <button id="noDelete" onclick="cancelDelete()">no we era mentira</button>
  </div>
</div>

<img id="mario" src="https://i.imgur.com/zcy39mh.png" alt="Mario">

<iframe id="ytPlayer" width="0" height="0"
src="https://www.youtube.com/embed/NTa6Xbzfq1U?autoplay=1&enablejsapi=1"
frameborder="0" allow="autoplay" allowfullscreen></iframe>

<script>
let ytPlayer;
let musicOn=true;
let stopActive=false;
let playlistIndex=0;
let playlistIds=['NTa6Xbzfq1U','7tTVYfgDf6g','CxKTbcs1t7M','V31PVkwzpEY','KK3KXAECte4','kL8CyVqzmkc','osPq9Yb8xm8'];

const tables=[...document.querySelectorAll('table')];
const menuPanel=document.getElementById("menuPanel");
const bigCategory=document.getElementById("bigCategory");
const menuCatBtn=document.getElementById("menuCatBtn");
const importPanel=document.getElementById("importPanel");
const rulesPanel=document.getElementById("rulesPanel");
const songName=document.getElementById("songName");
const musicBtn=document.getElementById("musicBtn");
const currentSong=document.getElementById("currentSong");

// ---------------- MENU ----------------
function hideAll(){tables.forEach(t=>t.style.display='none'); importPanel.style.display='none'; rulesPanel.style.display='none';}
function toggleMenu(){menuPanel.style.display=(menuPanel.style.display==='block'?'none':'block'); hideAll();}
function toggleCategories(){ bigCategory.style.display=(bigCategory.style.display==='block'?'none':'block'); }
function toggleBigCategory(){ bigCategory.style.display=(bigCategory.style.display==='block'?'none':'block'); }
function firstCategory(id){ bigCategory.style.display='none'; menuCatBtn.style.display='block'; showCategory(id);}
function showCategory(id){ hideAll(); const t=document.getElementById(id); t.style.display='table'; sortTable(t); menuPanel.style.display='none'; bigCategory.style.display='none'; t.scrollIntoView({behavior:'smooth'});}

// ---------------- MÚSICA ----------------
function onYouTubeIframeAPIReady(){
  ytPlayer=new YT.Player('ytPlayer',{events:{
    'onReady':()=>{ytPlayer.playVideo(); updateSongDisplay();},
    'onStateChange':(e)=>{if(e.data===0){nextSong();} updateSongDisplay();}
  }});
}
function toggleMusic(){if(musicOn){ytPlayer.pauseVideo();musicOn=false;musicBtn.className="off";stopActive=false;}else{ytPlayer.playVideo();musicOn=true;musicBtn.className="on";}}
function toggleStop(){if(!ytPlayer) return; if(!stopActive){ytPlayer.pauseVideo();stopActive=true;}else{ytPlayer.playVideo();stopActive=false;}}
function updateSongDisplay(){if(!ytPlayer||!ytPlayer.getVideoData) return; const data=ytPlayer.getVideoData(); const title=data.title||'Canción'; songName.innerText='Estás escuchando: '+title; songName.style.display='block'; songName.style.animation='fadeInOut 5s forwards'; currentSong.innerText=title; document.getElementById('trackCounter').innerText=(playlistIndex+1)+' / '+playlistIds.length;}
function nextSong(){playlistIndex=(playlistIndex+1)%playlistIds.length; ytPlayer.loadVideoById(playlistIds[playlistIndex]); updateSongDisplay();}
function prevSong(){playlistIndex=(playlistIndex-1+playlistIds.length)%playlistIds.length; ytPlayer.loadVideoById(playlistIds[playlistIndex]); updateSongDisplay();}

// ---------------- SPEEDRUNS ----------------
function loadRuns(){
  const saved=JSON.parse(localStorage.getItem('papuSpeedruns')||'{}');
  for(const cat in saved){
    const table=document.getElementById(cat);
    saved[cat].forEach(run=>{
      const row=document.createElement('tr');
      row.innerHTML=`<td></td><td>${run.name}</td><td>${run.time.toFixed(2)}</td><td>${run.platform}</td><td>${run.video?`<a href="${run.video}" target="_blank">VER</a>`:'--'}</td>`;
      table.appendChild(row);
    });
    sortTable(table);
  }
}
function saveRuns(){const data={};tables.forEach(t=>{data[t.id]=[...t.rows].slice(1).map(r=>({name:r.cells[1].innerText,time:parseFloat(r.cells[2].innerText),platform:r.cells[3].innerText,video:r.cells[4].querySelector('a')?r.cells[4].querySelector('a').href:''}));}); localStorage.setItem('papuSpeedruns',JSON.stringify(data));}
function addSpeedrun(){const pass=document.getElementById('importPass').value;if(pass!=='ELPAPUESPRO'){alert('Contraseña incorrecta');return;}const name=document.getElementById('playerName').value.trim();const time=parseFloat(document.getElementById('playerTime').value);const video=document.getElementById('playerVideo').value.trim();const category=document.getElementById('runCategory').value;if(!name||!time){alert('Completa todos los campos');return;}const table=document.getElementById(category);const row=document.createElement('tr');row.innerHTML=`<td></td><td>${name}</td><td>${time.toFixed(2)}</td><td>Custom</td><td>${video?`<a href="${video}" target="_blank">VER</a>`:'--'}</td>`;table.appendChild(row);sortTable(table);saveRuns();document.getElementById('playerName').value='';document.getElementById('playerTime').value='';document.getElementById('playerVideo').value='';importPanel.style.display='none';}

// ---------------- BORRAR ----------------
let runToDelete=null;
function showDeletePanel(){document.getElementById('deletePanel').style.display='block';document.getElementById('deleteConfirm').style.display='none';document.getElementById('deletePass').value='';runToDelete=null;}
function confirmDelete(){const pass=document.getElementById('deletePass').value;if(pass!=='ELPAPUESPRO'){alert('Contraseña incorrecta');return;}const visibleTable=tables.find(t=>t.style.display==='table');if(!visibleTable){alert('Primero selecciona una categoría visible');return;}if(visibleTable.rows.length<=1){alert('No hay runs para borrar');return;}runToDelete=visibleTable.rows[1];document.getElementById('deleteConfirm').style.display='block';}
function deleteRun(){if(runToDelete){runToDelete.remove();runToDelete=null;document.getElementById('deletePanel').style.display='none';saveRuns();}}
function cancelDelete(){runToDelete=null;document.getElementById('deletePanel').style.display='none';}

// ---------------- ORDENAR TABLA ----------------
function sortTable(table){const rows=[...table.rows].slice(1);const valid=rows.filter(r=>r.cells[2].innerText!=='');valid.sort((a,b)=>parseFloat(a.cells[2].innerText)-parseFloat(b.cells[2].innerText));valid.forEach((r,i)=>{r.classList.remove('top1','top2','top3');if(i===0)r.classList.add('top1');if(i===1)r.classList.add('top2');if(i===2)r.classList.add('top3');r.cells[0].innerText=i+1;table.appendChild(r);});}

// ---------------- ABRIR/CERRAR ----------------
function showImport(){hideAll();importPanel.style.display='block';menuPanel.style.display='none';}
function showRules(){hideAll();rulesPanel.style.display='block';menuPanel.style.display='none';}
function closePanels(){hideAll();}

// ---------------- ANIMACION MARIO ----------------
const mario=document.getElementById('mario');
let marioX=0;
let marioFrame=0;
const marioFrames=[
  'https://i.imgur.com/zcy39mh.png', // frame 1
  'https://i.imgur.com/u6qbqh2.png', // frame 2
  'https://i.imgur.com/Ln1pone.png'  // frame 3
];
function animateMario(){
  marioX += 2; // velocidad
  if(marioX > window.innerWidth) marioX = -64; // reaparece a la izquierda
  mario.style.left = marioX + 'px';
  mario.src = marioFrames[marioFrame];
  marioFrame = (marioFrame + 1) % marioFrames.length;
  requestAnimationFrame(animateMario);
}

// ---------------- INICIALIZACIÓN ----------------
window.onload=()=>{
  loadRuns();
  showCategory('lvl11'); // mostrar por defecto
  animateMario(); // iniciar animación Mario
};
</script>
<script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
