<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PAPU Speedruns</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body{
  background:black;
  color:white;
  margin:0;
  font-family:'Press Start 2P', monospace;
  overflow-x:hidden;
  position:relative;
}
body::before{
  content:"";
  position:fixed;
  top:0;
  left:0;
  width:200%;
  height:200%;
  background-image:repeating-linear-gradient(45deg,#222 0 1px,#111 1px 2px);
  z-index:-1;
  animation:bgMove 20s linear infinite;
}
@keyframes bgMove{
  0%{transform:translate(0,0);}
  50%{transform:translate(-50px,50px);}
  100%{transform:translate(0,0);}
}
.menu{
  position:fixed; top:20px; right:30px; font-size:48px; cursor:pointer; z-index:100;
}
.menu-panel{
  display:none; position:fixed; top:90px; right:30px; background:#111; border:4px solid white; padding:20px; width:320px; z-index:100;
}
.menu-panel button{
  width:100%; margin-bottom:12px; padding:14px; font-family:'Press Start 2P'; font-size:14px; background:black; color:white; border:3px solid white; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;
}
.menu-panel button:hover{
  transform:scale(1.05) rotate(-1deg); box-shadow:0 0 12px white;
}
#currentCategory{
  text-align:center; font-size:28px; margin-top:10px; color:#00ff00;
}
.title-wrapper{text-align:center; margin-top:15vh; font-size:64px;}
.title-line{display:block; animation:slideDown 1s ease forwards;}
@keyframes slideDown{0%{transform:translateY(-100px); opacity:0;}100%{transform:translateY(0); opacity:1;}}
.subtitle{text-align:center; margin-top:20px; font-size:24px;}
#categoryMainBtn{display:block; margin:20px auto 30px auto; background:black; border:4px solid white; color:red; font-family:'Press Start 2P'; font-size:24px; padding:20px; width:70%; text-align:center; cursor:pointer; transition:transform 0.15s, box-shadow 0.15s;}
#categoryMainBtn:hover{transform:scale(1.05) rotate(1deg); box-shadow:0 0 12px white;}
.category-panel{display:none; margin:0 auto 30px auto; text-align:center; background:#111; border:4px solid white; padding:20px; width:300px;}
.category-panel button{width:90%; margin:10px 0; padding:14px; font-family:'Press Start 2P'; font-size:16px; background:black; color:white; border:3px solid white; cursor:pointer; transition:transform 0.15s;}
.category-panel button:hover{transform:scale(1.1) rotate(1deg); box-shadow:0 0 10px white;}
table{width:95%; margin:20px auto 50px auto; border-collapse:collapse; font-size:16px; display:none;}
th,td{border:3px solid white; padding:12px; text-align:center; position:relative;}
th{background:#222;}
a{color:#00ffcc;text-decoration:none;}
.info-panel{display:none; margin:60px auto; background:#111; border:4px solid white; padding:30px; width:80%; text-align:center; position:relative;}
.close-btn{position:absolute; top:12px; right:16px; font-size:24px; cursor:pointer;}
.close-btn:hover{color:red;}
#miniPlayer{position:fixed; bottom:20px; right:20px; background:#111; border:4px solid white; width:220px; height:220px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px; z-index:1000; padding:10px;}
#miniPlayer #currentSong{color:#00ff00; font-family:'Press Start 2P'; font-size:18px; text-align:center;}
#miniPlayer .buttonsRow{display:flex; justify-content:space-around; width:100%;}
#miniPlayer .buttonsRow button{background:black; color:white; border:3px solid white; font-family:'Press Start 2P'; font-size:18px; cursor:pointer; padding:10px 14px; width:30%; transition:0.2s;}
#miniPlayer .buttonsRow button:hover{transform:scale(1.1); box-shadow:0 0 10px white;}
#trackCounter{margin-top:10px; color:#00ff00; font-family:'Press Start 2P'; font-size:14px; text-align:center;}
.top1{animation:glowGold 1s infinite alternate;}
.top2{animation:glowSilver 1s infinite alternate;}
.top3{animation:glowBronze 1s infinite alternate;}
@keyframes glowGold{0%{text-shadow:0 0 5px #FFD700;}100%{text-shadow:0 0 20px #FFD700;}}
@keyframes glowSilver{0%{text-shadow:0 0 5px #C0C0C0;}100%{text-shadow:0 0 20px #C0C0C0;}}
@keyframes glowBronze{0%{text-shadow:0 0 5px #CD7F32;}100%{text-shadow:0 0 20px #CD7F32;}}
</style>
</head>
<body>

<div class="menu" onclick="toggleMenu()">☰</div>
<div class="menu-panel" id="menuPanel">
  <button id="menuCatBtn" class="on" onclick="toggleCategories()" style="display:none">Categorías</button>
  <button onclick="showImport()">Importar Speedruns</button>
  <button onclick="showDeletePanel()">Borrar Speedruns</button>
  <button id="musicBtn" class="on" onclick="toggleMusic()">Música ON/OFF</button>
</div>

<div id="currentCategory"></div>

<div class="title-wrapper">
  <span class="title-line">EL PAPU</span>
  <span class="title-line">SPEEDRUNS</span>
</div>

<div class="subtitle">Clasificación</div>
<button id="categoryMainBtn" onclick="toggleBigCategory()">Categorías</button>
<div class="category-panel" id="bigCategory">
  <button onclick="firstCategory('lvl11')">1-1 Level</button>
  <button onclick="firstCategory('any')">Any%</button>
  <button onclick="firstCategory('warpless')">Warpless</button>
  <button onclick="firstCategory('moon11')">Moonwalk Jump Solo - 1-1</button>
  <button onclick="firstCategory('moonAny')">Moonwalk Jump Solo - Any%</button>
</div>

<!-- Tablas -->
<table id="lvl11"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="any"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="warpless"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="moon11"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="moonAny"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>

<!-- IMPORTAR SPEEDRUN PANEL -->
<div class="info-panel" id="importPanel">
<span class="close-btn" onclick="closePanels()">✕</span>
<h3>Importar Speedrun</h3>
<input type="password" id="importPass" placeholder="Contraseña"><br><br>
<input type="text" id="playerName" placeholder="Nombre jugador">
<input type="number" id="playerTime" placeholder="Tiempo">
<input type="text" id="playerVideo" placeholder="URL del video">
<select id="runCategory">
  <option value="lvl11">1-1 Level</option>
  <option value="any">Any%</option>
  <option value="warpless">Warpless</option>
  <option value="moon11">Moonwalk Jump Solo - 1-1</option>
  <option value="moonAny">Moonwalk Jump Solo - Any%</option>
</select>
<br><br>
<button onclick="addSpeedrun()">Agregar Speedrun</button>
</div>

<!-- MINI PLAYER -->
<div id="miniPlayer">
  <div id="currentSong">Cargando...</div>
  <div class="buttonsRow">
    <button onclick="prevSong()">◀</button>
    <button onclick="toggleStop()">⏹</button>
    <button onclick="nextSong()">▶</button>
  </div>
  <div id="trackCounter">1 / 11</div>
</div>

<iframe id="ytPlayer" width="0" height="0"
src="https://www.youtube.com/embed/NTa6Xbzfq1U?autoplay=1&enablejsapi=1"
frameborder="0" allow="autoplay" allowfullscreen></iframe>

<script>
let ytPlayer, musicOn=true, stopActive=false, playlistIndex=0;
let playlistIds=['NTa6Xbzfq1U','7tTVYfgDf6g','Rrx0F1TzQ0M','7hG-96NiMXU','3GqWF2a-fo8','3H220odl1D4','EMUh6vPjBXc','VXdCEKIQiGE','KK3KXAECte4','kL8CyVqzmkc','osPq9Yb8xm8'];
const currentSong=document.getElementById('currentSong');
const trackCounter=document.getElementById('trackCounter');
const menuPanel=document.getElementById("menuPanel");
const bigCategory=document.getElementById("bigCategory");
const menuCatBtn=document.getElementById("menuCatBtn");
const currentCategoryDiv = document.getElementById("currentCategory");

/* -------------------- Mini Player -------------------- */
function onYouTubeIframeAPIReady(){
  ytPlayer=new YT.Player('ytPlayer',{
    events:{'onReady':()=>{ytPlayer.playVideo(); setTimeout(updateSongDisplay,500);},
      'onStateChange':(e)=>{if(e.data===YT.PlayerState.ENDED){nextSong();}else if(e.data===YT.PlayerState.PLAYING){setTimeout(updateSongDisplay,200);}}}
  });
}
function updateSongDisplay(){
  if(!ytPlayer || !ytPlayer.getVideoData) return;
  const data=ytPlayer.getVideoData();
  currentSong.innerText=data.title||"Canción";
  trackCounter.innerText=(playlistIndex+1)+" / "+playlistIds.length;
}
function toggleMusic(){ if(!ytPlayer)return; if(musicOn){ytPlayer.pauseVideo(); musicOn=false; stopActive=true;} else{ytPlayer.playVideo(); musicOn=true; stopActive=false;} }
function toggleStop(){ if(!ytPlayer)return; if(!stopActive){ytPlayer.pauseVideo(); stopActive=true;} else{ytPlayer.playVideo(); stopActive=false;} }
function nextSong(){ playlistIndex=(playlistIndex+1)%playlistIds.length; ytPlayer.loadVideoById(playlistIds[playlistIndex]); setTimeout(updateSongDisplay,500);}
function prevSong(){ playlistIndex=(playlistIndex-1+playlistIds.length)%playlistIds.length; ytPlayer.loadVideoById(playlistIds[playlistIndex]); setTimeout(updateSongDisplay,500);}

/* -------------------- Menú -------------------- */
function toggleMenu(){ menuPanel.style.display = menuPanel.style.display==="block"?"none":"block"; }
function toggleBigCategory(){ bigCategory.style.display = bigCategory.style.display==="block"?"none":"block"; }
function firstCategory(id){ bigCategory.style.display="none"; menuCatBtn.style.display="block"; showCategory(id);}
function showCategory(id){[...document.querySelectorAll("table")].forEach(t=>t.style.display="none"); document.getElementById(id).style.display="table"; currentCategoryDiv.innerText={"lvl11":"1-1 Level","any":"Any%","warpless":"Warpless","moon11":"Moonwalk Jump Solo - 1-1","moonAny":"Moonwalk Jump Solo - Any%"}[id]||""; loadRuns();}

/* -------------------- Speedruns -------------------- */
function saveRuns(){ const data={}; [...document.querySelectorAll("table")].forEach(t=>{ data[t.id]=[...t.rows].slice(1).map(r=>({name:r.cells[1].innerText,time:parseFloat(r.cells[2].innerText),platform:r.cells[3].innerText,video:r.cells[4].querySelector('a')?r.cells[4].querySelector('a').href:''})); }); localStorage.setItem('papuSpeedruns',JSON.stringify(data)); }
function loadRuns(){ const saved=JSON.parse(localStorage.getItem('papuSpeedruns')||'{}'); for(const cat in saved){ const table=document.getElementById(cat); saved[cat].forEach(run=>{ const row=document.createElement('tr'); row.innerHTML=`<td></td><td>${run.name}</td><td>${run.time.toFixed(2)}</td><td>${run.platform}</td><td>${run.video?`<a href="${run.video}" target="_blank">VER</a>`:'--'}</td>`; table.appendChild(row); }); sortTable(table); } }
function sortTable(table){ const rows=[...table.rows].slice(1); rows.sort((a,b)=>parseFloat(a.cells[2].innerText)-parseFloat(b.cells[2].innerText)); rows.forEach((r,i)=>{ r.classList.remove("top1","top2","top3"); if(i===0) r.classList.add("top1"); if(i===1) r.classList.add("top2"); if(i===2) r.classList.add("top3"); r.cells[0].innerText=i+1; table.appendChild(r); }); }

/* -------------------- Importar -------------------- */
function showImport(){ [...document.querySelectorAll("table")].forEach(t=>t.style.display="none"); importPanel.style.display='block'; menuPanel.style.display='none'; }
function addSpeedrun(){
  const pass=document.getElementById('importPass').value;
  if(pass!=="ELPAPUESPRO"){ alert("Contraseña incorrecta"); return; }
  const name=document.getElementById('playerName').value.trim();
  const time=parseFloat(document.getElementById('playerTime').value);
  const video=document.getElementById('playerVideo').value.trim();
  const category=document.getElementById('runCategory').value;
  if(!name||!time){ alert("Completa todos los campos"); return; }
  const table=document.getElementById(category);
  const row=document.createElement('tr');
  row.innerHTML=`<td></td><td>${name}</td><td>${time.toFixed(2)}</td><td>Custom</td><td>${video?`<a href="${video}" target="_blank">VER</a>`:'--'}</td>`;
  table.appendChild(row);
  sortTable(table); saveRuns();
  document.getElementById('playerName').value=""; document.getElementById('playerTime').value=""; document.getElementById('playerVideo').value=""; document.getElementById('importPass').value="";
  importPanel.style.display="none";
}

/* -------------------- Borrar -------------------- */
function showDeletePanel(){
  const visibleTable=[...document.querySelectorAll("table")].find(t=>t.style.display==="table");
  if(!visibleTable||visibleTable.rows.length<=1){ alert("No hay runs visibles"); return; }
  const rows=[...visibleTable.rows].slice(1);
  const list=rows.map((r,i)=>`${i+1}: ${r.cells[1].innerText} - ${r.cells[2].innerText}`).join("\n");
  const sel=prompt("Selecciona el número del run a borrar:\n"+list);
  const index=parseInt(sel)-1;
  if(isNaN(index)||index<0||index>=rows.length){ alert("Selección inválida"); return; }
  const runToDelete=rows[index];
  const pass=prompt("Introduce contraseña para borrar:");
  if(pass!=="ELPAPUESPRO"){ alert("Contraseña incorrecta"); return; }
  const confirmDelete=confirm("REALMENTE QUIERES BORRAR ESTE RUN?, NO PODRÁS RECUPERARLO JAMÁS BRO :V");
  if(confirmDelete){ runToDelete.remove(); saveRuns(); alert("Run borrado exitosamente"); }
}

/* -------------------- Panels -------------------- */
function closePanels(){ [...document.querySelectorAll(".info-panel")].forEach(p=>p.style.display='none'); }

/* -------------------- Inicialización -------------------- */
window.onload=()=>{ showCategory('lvl11'); }
</script>
<script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
