<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>PAPU Speedruns</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

body{
  background:black;
  color:white;
  margin:0;
  font-family:'Press Start 2P', monospace;
  overflow-x:hidden;
  position:relative;
}

/* ---------- FONDO ANIMADO NES ---------- */
body::before{
  content:"";
  position:fixed;
  top:0;
  left:0;
  width:200%;
  height:200%;
  background-image:repeating-linear-gradient(45deg,#222 0 1px,#111 1px 2px);
  z-index:-1;
  animation:bgMove 20s linear infinite;
}
@keyframes bgMove{
  0%{transform:translate(0,0);}
  50%{transform:translate(-50px,50px);}
  100%{transform:translate(0,0);}
}

/* ---------- MENU ---------- */
.menu{
  position:fixed;
  top:20px;
  right:30px;
  font-size:48px;
  cursor:pointer;
  z-index:100;
}
.menu-panel{
  display:none;
  position:fixed;
  top:90px;
  right:30px;
  background:#111;
  border:4px solid white;
  padding:20px;
  width:320px;
  z-index:100;
}
.menu-panel button{
  width:100%;
  margin-bottom:12px;
  padding:14px;
  font-family:'Press Start 2P';
  font-size:14px;
  background:black;
  color:white;
  border:3px solid white;
  cursor:pointer;
  transition:transform 0.15s, box-shadow 0.15s;
}
.menu-panel button:hover{
  transform:scale(1.05) rotate(-1deg);
  box-shadow:0 0 12px white;
}

/* ---------- TITULO ---------- */
.title-wrapper{
  text-align:center;
  margin-top:15vh;
  font-size:64px;
}
.title-line{
  display:block;
  animation:slideDown 1s ease forwards;
}
@keyframes slideDown{
  0%{transform:translateY(-100px); opacity:0;}
  100%{transform:translateY(0); opacity:1;}
}
.subtitle{
  text-align:center;
  margin-top:20px;
  font-size:24px;
}

/* ---------- BOTON CATEGORIAS ---------- */
#categoryMainBtn{
  display:block;
  margin:20px auto 30px auto;
  background:black;
  border:4px solid white;
  color:red;
  font-family:'Press Start 2P';
  font-size:24px;
  padding:20px;
  width:70%;
  text-align:center;
  cursor:pointer;
  transition:transform 0.15s, box-shadow 0.15s;
}
#categoryMainBtn:hover{
  transform:scale(1.05) rotate(1deg);
  box-shadow:0 0 12px white;
}

/* ---------- CATEGORY PANEL ---------- */
.category-panel{
  display:none;
  margin:0 auto 30px auto;
  text-align:center;
  background:#111;
  border:4px solid white;
  padding:20px;
  width:300px;
}
.category-panel button{
  width:90%;
  margin:10px 0;
  padding:14px;
  font-family:'Press Start 2P';
  font-size:16px;
  background:black;
  color:white;
  border:3px solid white;
  cursor:pointer;
  transition:transform 0.15s;
}
.category-panel button:hover{
  transform:scale(1.1) rotate(1deg);
  box-shadow:0 0 10px white;
}

/* ---------- TABLAS ---------- */
table{
  width:95%;
  margin:20px auto 50px auto;
  border-collapse:collapse;
  font-size:16px;
  display:none;
}
th,td{
  border:3px solid white;
  padding:12px;
  text-align:center;
  position:relative;
}
th{background:#222;}
a{color:#00ffcc;text-decoration:none;}

/* ---------- INFO PANELS ---------- */
.info-panel{
  display:none;
  margin:60px auto;
  background:#111;
  border:4px solid white;
  padding:30px;
  width:80%;
  text-align:center;
  position:relative;
}
.close-btn{
  position:absolute;
  top:12px;
  right:16px;
  font-size:24px;
  cursor:pointer;
}
.close-btn:hover{color:red;}

/* ---------- MINI PLAYER ---------- */
#miniPlayer{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#111;
  border:4px solid white;
  width:220px;
  height:220px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
  z-index:1000;
  padding:10px;
}
#miniPlayer #currentSong{
  color:#00ff00;
  font-family:'Press Start 2P';
  font-size:18px;
  text-align:center;
}
#miniPlayer .buttonsRow{
  display:flex;
  justify-content:space-around;
  width:100%;
}
#miniPlayer .buttonsRow button{
  background:black;
  color:white;
  border:3px solid white;
  font-family:'Press Start 2P';
  font-size:18px;
  cursor:pointer;
  padding:10px 14px;
  width:30%;
  transition:0.2s;
}
#miniPlayer .buttonsRow button:hover{
  transform:scale(1.1);
  box-shadow:0 0 10px white;
}

/* ---------- MINI CONTADOR DE PISTAS ---------- */
#trackCounter{
  margin-top:10px;
  color:#00ff00;
  font-family:'Press Start 2P';
  font-size:14px;
  text-align:center;
}

/* ---------- RESALTAR 1°,2°,3° ---------- */
.top1{animation:glowGold 1s infinite alternate;}
.top2{animation:glowSilver 1s infinite alternate;}
.top3{animation:glowBronze 1s infinite alternate;}
@keyframes glowGold{0%{text-shadow:0 0 5px #FFD700;}100%{text-shadow:0 0 20px #FFD700;}}
@keyframes glowSilver{0%{text-shadow:0 0 5px #C0C0C0;}100%{text-shadow:0 0 20px #C0C0C0;}}
@keyframes glowBronze{0%{text-shadow:0 0 5px #CD7F32;}100%{text-shadow:0 0 20px #CD7F32;}}
</style>
</head>
<body>

<div class="menu" onclick="toggleMenu()">☰</div>
<div class="menu-panel" id="menuPanel">
  <button id="menuCatBtn" class="on" onclick="toggleCategories()" style="display:none">Categorías</button>
  <button onclick="showImport()">Importar Speedruns</button>
  <button onclick="showDeletePanel()">Borrar Speedruns</button>
  <button onclick="showRules()">REGLAS</button>
  <button id="musicBtn" class="on" onclick="toggleMusic()">Música ON/OFF</button>
</div>

<div class="title-wrapper">
  <span class="title-line">EL PAPU</span>
  <span class="title-line">SPEEDRUNS</span>
</div>

<div class="subtitle">Clasificación</div>
<button id="categoryMainBtn" onclick="toggleBigCategory()">Categorías</button>
<div class="category-panel" id="bigCategory">
  <button onclick="firstCategory('lvl11')">1-1 Level</button>
  <button onclick="firstCategory('any')">Any%</button>
  <button onclick="firstCategory('warpless')">Warpless</button>
  <button onclick="firstCategory('moon11')">Moonwalk Jump Solo - 1-1</button>
  <button onclick="firstCategory('moonAny')">Moonwalk Jump Solo - Any%</button>
</div>

<!-- Tablas -->
<table id="lvl11"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="any"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="warpless"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="moon11"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>
<table id="moonAny"><tr><th>Puesto</th><th>Jugador</th><th>Tiempo</th><th>Plataforma</th><th>Video</th></tr></table>

<!-- Importar Speedrun Panel -->
<div class="info-panel" id="importPanel">
<span class="close-btn" onclick="closePanels()">✕</span>
<h3>Importar Speedrun</h3>
<input type="password" id="importPass" placeholder="Contraseña">
<br><br>
<input type="text" id="playerName" placeholder="Nombre jugador">
<input type="number" id="playerTime" placeholder="Tiempo">
<input type="text" id="playerVideo" placeholder="URL del video">
<select id="runCategory">
  <option value="lvl11">1-1 Level</option>
  <option value="any">Any%</option>
  <option value="warpless">Warpless</option>
  <option value="moon11">Moonwalk Jump Solo - 1-1</option>
  <option value="moonAny">Moonwalk Jump Solo - Any%</option>
</select>
<br><br>
<button onclick="addSpeedrun()">Agregar Speedrun</button>
</div>

<!-- Mini Player -->
<div id="miniPlayer">
  <button id="playlistBtn" onclick="togglePlaylist()" style="width:220px;">Lista de Música</button>
  <div id="currentSong">Cargando...</div>
  <div class="buttonsRow">
    <button onclick="prevSong()">◀</button>
    <button onclick="toggleStop()">⏹</button>
    <button onclick="nextSong()">▶</button>
  </div>
  <div id="trackCounter">1 / 12</div>
</div>

<!-- Lista de Música -->
<div id="playlistPanel" class="info-panel" style="display:none; overflow-y:auto; max-height:300px;">
  <span class="close-btn" onclick="togglePlaylist()">✕</span>
  <h3>Lista de Música</h3>
  <div id="playlistSongs"></div>
</div>

<iframe id="ytPlayer" width="0" height="0" src="https://www.youtube.com/embed/NTa6Xbzfq1U?autoplay=1&enablejsapi=1" frameborder="0" allow="autoplay" allowfullscreen></iframe>

<script>
let ytPlayer;
let musicOn = true;
let stopActive = false;
let playlistIndex = 0;

let playlistIds = ['NTa6Xbzfq1U','7tTVYfgDf6g','VXdCEKIQiGE','3GqWF2a-fo8','bmP3UHXYi28','3H220odl1D4','DTpksvCC-hg','CxKTbcs1t7M','V31PVkwzpEY','KK3KXAECte4','kL8CyVqzmkc','osPq9Yb8xm8'];
let playlistTitles = ['Super Mario Bros Theme','Song 2','Song 3','Song 4','Song 5','Song 6','Song 7','Song 8','Song 9','Song 10','Song 11','Song 12'];

const currentSong = document.getElementById('currentSong');
const trackCounter = document.getElementById('trackCounter');
const playlistPanel = document.getElementById('playlistPanel');
const playlistSongsDiv = document.getElementById('playlistSongs');
const musicBtn = document.getElementById('musicBtn');

function onYouTubeIframeAPIReady() {
  ytPlayer = new YT.Player('ytPlayer', {
    events: {
      'onReady': () => { ytPlayer.playVideo(); updateSongDisplay(); },
      'onStateChange': (event) => { if(event.data === YT.PlayerState.ENDED){ nextSong(); } }
    }
  });
}

function updateSongDisplay(){
  if(!ytPlayer) return;
  currentSong.innerText = playlistTitles[playlistIndex];
  trackCounter.innerText = (playlistIndex+1) + " / " + playlistIds.length;
}

function toggleMusic(){ if(!ytPlayer) return; if(musicOn){ ytPlayer.pauseVideo(); musicOn=false; stopActive=true; musicBtn.className="off"; } else{ ytPlayer.playVideo(); musicOn=true; stopActive=false; musicBtn.className="on"; } }
function toggleStop(){ if(!ytPlayer) return; if(!stopActive){ ytPlayer.pauseVideo(); stopActive=true; } else{ ytPlayer.playVideo(); stopActive=false; } }
function nextSong(){ playlistIndex=(playlistIndex+1)%playlistIds.length; ytPlayer.loadVideoById(playlistIds[playlistIndex]); updateSongDisplay(); }
function prevSong(){ playlistIndex=(playlistIndex-1+playlistIds.length)%playlistIds.length; ytPlayer.loadVideoById(playlistIds[playlistIndex]); updateSongDisplay(); }

function togglePlaylist(){
  if(playlistPanel.style.display==='block'){ playlistPanel.style.display='none'; }
  else{ playlistPanel.style.display='block'; renderPlaylist(); }
}

function renderPlaylist(){
  playlistSongsDiv.innerHTML='';
  playlistTitles.forEach((title,i)=>{
    const btn=document.createElement('button');
    btn.innerText=title;
    btn.style.display='block';
    btn.style.width='95%';
    btn.style.margin='5px auto';
    btn.style.padding='10px';
    btn.style.background='black';
    btn.style.color='white';
    btn.style.border='2px solid white';
    btn.style.cursor='pointer';
    btn.onclick=()=>{ playlistIndex=i; ytPlayer.loadVideoById(playlistIds[playlistIndex]); updateSongDisplay(); };
    playlistSongsDiv.appendChild(btn);
  });
}

/* -------------------- Resto de tus funciones de categorías y speedruns se mantienen -------------------- */
</script>
<script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
